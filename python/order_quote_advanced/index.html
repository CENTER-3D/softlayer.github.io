<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Advanced Quote Ordering - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/python/order_quote_advanced/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/fa-svg-with-js.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>
    <script src="https://sldn.softlayer.com/js/fontawesome-all.js"></script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-88235803-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/perl/">Perl</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>August 7, 2018<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Billing_Order_Quote">SoftLayer_Billing_Order_Quote</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Account">SoftLayer_Account</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Product_Order">SoftLayer_Product_Order</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Location">SoftLayer_Location</a>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/order">order</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/quote">quote</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/sshkeys">sshkeys</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/provisionscripts">provisionScripts</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm  article" style="word-wrap: break-word;">
                <div class="article-title">
				    <h1>Advanced Quote Ordering</h1>
                    <small>Place an order using a quote with SSH keys and post provisioning scripts. Along with a few examples of how to get the needed data.</small>
                </div>
				
                
				
                <h2 id="quotes">Quotes</h2>
<p>Quotes are a way to save an order, and then easily duplicate the order later. You can create a quote from the control portal by going through the normal order process, and then instead of hitting &ldquo;Order&rdquo; at the end, there will be a button that says &ldquo;Save Quote&rdquo;, which will save the order for later. You can then use the quote service to pull down the information about it from the API. <code>listQuotes</code> in the example below does exactly this.</p>
<p>To order from a quote you will need the following bits of information</p>
<ul>
<li>Quote ID</li>
<li>Datacenter ID where you want the order to end up</li>
<li>Other bits of optional data, like SSH keys, vlan ids, image ids, etc.</li>
</ul>
<h3 id="rest-api-call">REST API Call</h3>
<p><code>curl -u $SL_USER:$SL_APIKEY 'https://api.softlayer.com/rest/v3.1/SoftLayer_Account/getActiveQuotes.json?objectMask=mask%5Border%5Bid%2C+orderTotalAmount%2C+orderTopLevelItems%5Bid%2C+description%5D%5D%2C+ordersFromQuoteCount%5D'</code></p>
<h3 id="python-output">Python Output</h3>
<p>The sample code will output something like this. Quotes can be PENDING, which means they might expire if you don&rsquo;t call <a href="https://softlayer.github.io/reference/services/SoftLayer_Billing_Order_Quote/saveQuote/">SoftLayer_Billing_Order_Quote::saveQuote(id=quoteId)</a> before its expiration date. SAVED quotes will stick around until you call <a href="https://softlayer.github.io/reference/services/SoftLayer_Billing_Order_Quote/deleteQuote/">SoftLayer_Billing_Order_Quote::deleteQuote(id=quoteId)</a>
The quoteId in the first column is what will be used for placing the order. Description is just the topLevelBillingItem for the quote.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ID, createDate, name, status, order count, description
2460465, 2018-07-23T14:20:59-06:00, Ruber, SAVED, 0, Single Intel Xeon E3-1270 v3 <span style="color:#f92672">(</span><span style="color:#ae81ff">4</span> Cores, 3.50 GHz<span style="color:#f92672">)</span>
2457385, 2018-07-17T14:23:54-06:00, AJCB-TESTWITHSSHKEYS, PENDING, 0, Single Intel Xeon E3-1270 v3 <span style="color:#f92672">(</span><span style="color:#ae81ff">4</span> Cores, 3.50 GHz<span style="color:#f92672">)</span>
1528487, 2015-09-25T15:37:27-06:00, test-quote, SAVED, 3, <span style="color:#ae81ff">1</span> x 2.0 GHz Core
</code></pre></div><h2 id="finding-the-dc-id">Finding the DC id</h2>
<p>Now we need to figure out which DC we want to place the order in.
The way we are going to do this, is by checking the quote&rsquo;s top level item, and see what DCs that package is available in. Using <a href="https://softlayer.github.io/reference/services/SoftLayer_Location/getDatacenters/">SoftLayer_Location::getDatacenters()</a> would show you all datacenters, and not all packages are available in all datacenters.</p>
<h3 id="rest-call">REST Call</h3>
<p><code>'https://api.softlayer.com/rest/v3.1/SoftLayer_Billing_Order_Quote/&lt;QUOTEID&gt;/getObject.json?objectMask=mask[id,+order[id,orderTopLevelItems[id,package[id,availableLocations[location[longName,id]]]]]]'</code></p>
<h3 id="python">Python</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">listLocationsForQuote</span>(self, quoteId):
    mask<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mask[id, order[id, orderTopLevelItems[id, package[id, availableLocations[location[longName, id]]]]]]&#34;</span>
    locations <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>client[<span style="color:#e6db74">&#39;Billing_Order_Quote&#39;</span>]<span style="color:#f92672">.</span>getObject(id<span style="color:#f92672">=</span>quoteId, mask<span style="color:#f92672">=</span>mask)
    
    package_id <span style="color:#f92672">=</span> locations[<span style="color:#e6db74">&#39;order&#39;</span>][<span style="color:#e6db74">&#39;orderTopLevelItems&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;package&#39;</span>][<span style="color:#e6db74">&#39;id&#39;</span>]
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Package {} is available in the following locations...&#34;</span><span style="color:#f92672">.</span>format(package_id))
    <span style="color:#66d9ef">for</span> dc <span style="color:#f92672">in</span> locations[<span style="color:#e6db74">&#39;order&#39;</span>][<span style="color:#e6db74">&#39;orderTopLevelItems&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;package&#39;</span>][<span style="color:#e6db74">&#39;availableLocations&#39;</span>]:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;{}, id={}&#34;</span><span style="color:#f92672">.</span>format(dc[<span style="color:#e6db74">&#39;location&#39;</span>][<span style="color:#e6db74">&#39;longName&#39;</span>], dc[<span style="color:#e6db74">&#39;location&#39;</span>][<span style="color:#e6db74">&#39;id&#39;</span>]))
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">Package <span style="color:#ae81ff">46</span> is available in the following locations...
Seattle 1, id<span style="color:#f92672">=</span><span style="color:#ae81ff">18171</span>
Dallas 5, id<span style="color:#f92672">=</span><span style="color:#ae81ff">138124</span>
Houston 2, id<span style="color:#f92672">=</span><span style="color:#ae81ff">142775</span>
Dallas 7, id<span style="color:#f92672">=</span><span style="color:#ae81ff">142776</span>
San Jose 1, id<span style="color:#f92672">=</span><span style="color:#ae81ff">168642</span>
...
</code></pre></div><h2 id="building-our-new-order">Building our new order</h2>
<p>Ok, now we have a quote, a dc, now we just need to build our order out.</p>
<h3 id="softlayer_billing_order_quotegetrecalculatedordercontainerhttpssoftlayergithubioreferenceservicessoftlayer_billing_order_quotegetrecalculatedordercontainer"><a href="https://softlayer.github.io/reference/services/SoftLayer_Billing_Order_Quote/getRecalculatedOrderContainer/">SoftLayer_Billing_Order_Quote::getRecalculatedOrderContainer()</a></h3>
<p><code>'https://api.softlayer.com/rest/v3.1/SoftLayer_Billing_Order_Quote/&lt;QUOTEID&gt;/getRecalculatedOrderContainer.json</code></p>
<p>This function takes a quote, and returns an order container with all the proper price ids filled in, which are required to place the actual order.</p>
<p>With this order container, all we need to do is fill out some extra information (basically anything that would be on the last page of the order form).</p>
<h3 id="order-containershttpssoftlayergithubioreferencedatatypessoftlayer_container_product_order"><a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order/">Order containers</a></h3>
<p>The object you send in to the placeOrder method, is going to be a SoftLayer_Container_Product_Order, or possibly one of its child classes, like <a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Hardware_Server/">Hardware_Server</a> or <a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Virtual_Guest/">Virtual_Guest</a></p>
<p>The only data you have to change here is the hostname and domain for your servers, the location, and the quantity.</p>
<blockquote>
<p>If you are ordering baremetal, you need to change container[&lsquo;hardware&rsquo;], if you are ordering virtual guests, you need to change container[&lsquo;virtualGuests&rsquo;]</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">guests <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;hostname&#39;</span>: <span style="color:#e6db74">&#39;quotetest&#39;</span>, 
    <span style="color:#e6db74">&#39;domain&#39;</span>: <span style="color:#e6db74">&#39;example.com&#39;</span>
}
quote <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>client[<span style="color:#e6db74">&#39;Billing_Order_Quote&#39;</span>]
quote_container <span style="color:#f92672">=</span> quote<span style="color:#f92672">.</span>getRecalculatedOrderContainer(id<span style="color:#f92672">=</span>quote_id)
container <span style="color:#f92672">=</span> quote_container
container[<span style="color:#e6db74">&#39;complexType&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SoftLayer_Container_Product_Order_Virtual_Guest&#34;</span>
container[<span style="color:#e6db74">&#39;quantity&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
container[<span style="color:#e6db74">&#39;virtualGuests&#39;</span>] <span style="color:#f92672">=</span> []
container[<span style="color:#e6db74">&#39;virtualGuests&#39;</span>]<span style="color:#f92672">.</span>append(guests)
container[<span style="color:#e6db74">&#39;virtualGuests&#39;</span>]<span style="color:#f92672">.</span>append(guests)
container[<span style="color:#e6db74">&#39;location&#39;</span>] <span style="color:#f92672">=</span> dc_id
</code></pre></div><p>The <code>container['virtualGuests']</code> array should have 1 entry for each server you want to order. Since I am ordering 2 servers, I appeneded 2 entries to the array.</p>
<h3 id="complex-types">Complex Types</h3>
<p><code>getRecalculatedOrderContainer</code> will return a generic Container_Product_Order type, so you will need to specify the correct type to be able to actually place an order. Orders can occasionally work without specifying this complexType, but its better to be sure. There are quite a lot of container types, the full list can be found here: <a href="https://softlayer.github.io/reference/softlayerapi/">https://softlayer.github.io/reference/softlayerapi/</a> , and search for <code>Container_Product_Order</code> to see all the options.</p>
<p>The most common are:</p>
<ul>
<li><a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Hardware_Server">https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Hardware_Server</a></li>
<li><a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Hardware_Server_Gateway_Appliance">https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Hardware_Server_Gateway_Appliance</a></li>
<li><a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Network_LoadBalancer_AsAService">https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Network_LoadBalancer_AsAService</a></li>
<li><a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Network_Storage_AsAService">https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Network_Storage_AsAService</a></li>
<li><a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Network_Vlan">https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Network_Vlan</a></li>
<li><a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Virtual_Guest">https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Virtual_Guest</a></li>
</ul>
<h3 id="ssh-keys">SSH keys</h3>
<p>To have SSH keys installed on a server at order time, we need to specify them in the [sshKeys]https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_SshKeys/) property. This property is at the container level, NOT the guest level, even though guests have a sshKey property.
This propety is an array of sshKeys, which itself is an array of ids. This means that there needs to be 1 array of keys per server you are ordering, and the order they are applied should match the order they are listed in the virtualGuests propety. <code>sshKeys[0] =&gt; virtualGuests[0]</code>, <code>sshKeys[1] =&gt; virtualGuests[1]</code> and so on.</p>
<p>An sshKey itself should look like this</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">sshKey = {
    &#39;sshKeyIds&#39; : [1234, 456, 11111]
}
container[&#39;sshKeys&#39;].append(sshKey)
container[&#39;sshKeys&#39;].append(sshKey)
</code></pre></div><p>This is a bit combersome, but it does allow you the flexibility to order different sshKeys on different servers if you need to.</p>
<h3 id="post-provision-scripts">Post Provision Scripts</h3>
<p><a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Virtual_Guest/#provisionScripts">provisionScripts</a> are simply an array of strings (urls) to apply to each server in order. Like sshKeys, the order these provision scripts are listed match up with their virtualGuests. Each guest will only have 1 provision script run on it.</p>
<blockquote>
<p>Post provision scripts need to be HTTPS to be executed, HTTP scripts just get downloaded</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">scriptUrl = &#39;https://somesite.com/script.sh&#39;
container[&#39;provisionScripts&#39;] = [scriptUrl, scriptUrl]
</code></pre></div><h3 id="vlans-and-subnets">Vlans and Subnets</h3>
<p>Vlans and Subnets need to be specified at the guest level, not the container level. You will also need the VLAN/Subnet ID, which is different than the vlan number which can be a bit confusing to new api users.</p>
<p>Public Vlans and Public Subnets need to be added to the <a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Virtual_Guest/#primaryNetworkComponent">primaryNetworkComponent</a>.
Private Vlans and Private Subnets need to be added to the <a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Virtual_Guest/#primaryBackendNetworkComponent">primaryBackendNetworkComponent</a></p>
<p>This example selects a specific VLAN for the primaryNetwork, and a specific Subnet for the primaryBackendNetwork. You can have both a specific vlan and specific network, assuming the subnet is already routed to the vlan you specified.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">guest = {
    &#39;hostname&#39;: &#39;tester&#39;,
    &#39;domain&#39;: &#39;example.com&#39;,
    &#39;primaryNetworkComponent&#39;: {
        &#34;networkVlan&#34;: {&#34;id&#34;: int(public_vlan)}},
    &#34;primaryBackendNetworkComponent&#34;: {
        &#34;primarySubnet&#34;: {&#34;id&#34;: int(private_subnet)}}

}
</code></pre></div><h3 id="image-templates">Image Templates</h3>
<p>Instead of specifying a fresh operating system, you can have a server provisioned from a imageTemplate by specifying its ID.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">container[&#39;imageTemplateId&#39;] = image_id
</code></pre></div><p>This ISN&rsquo;T an array, so the imageTemplate here will get applied to all guests in the order.</p>
<h2 id="the-whole-script">The Whole Script</h2>
<p>This is the script I use when testing out bits of the ordering API, and hopefully it will be helpful in building your own way to order image templates.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> SoftLayer
<span style="color:#f92672">from</span> pprint <span style="color:#f92672">import</span> pprint <span style="color:#66d9ef">as</span> pp

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">example</span>():

    <span style="color:#66d9ef">def</span> __init__(self):
        self<span style="color:#f92672">.</span>client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
        debugger <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>DebugTransport(self<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>transport)
        self<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>transport <span style="color:#f92672">=</span> debugger

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">orderQuote</span>(self, quote_id, dc_id <span style="color:#f92672">=</span> None, image_id <span style="color:#f92672">=</span> None, private_vlan <span style="color:#f92672">=</span> None, public_vlan <span style="color:#f92672">=</span> None):
        <span style="color:#75715e"># If you have more than 1 server in the quote, you will need to append</span>
        <span style="color:#75715e"># a copy of this for each VSI, with hostnames changed as needed</span>
        guests <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#39;hostname&#39;</span>: <span style="color:#e6db74">&#39;quotetest&#39;</span>, 
            <span style="color:#e6db74">&#39;domain&#39;</span>: <span style="color:#e6db74">&#39;example.com&#39;</span>
        }
        <span style="color:#66d9ef">if</span> public_vlan:
            guests<span style="color:#f92672">.</span>update({
                <span style="color:#e6db74">&#39;primaryNetworkComponent&#39;</span>: {
                    <span style="color:#e6db74">&#34;networkVlan&#34;</span>: {<span style="color:#e6db74">&#34;id&#34;</span>: int(public_vlan)}}})
        <span style="color:#66d9ef">if</span> private_vlan:
            guests<span style="color:#f92672">.</span>update({
                <span style="color:#e6db74">&#34;primaryBackendNetworkComponent&#34;</span>: {
                    <span style="color:#e6db74">&#34;networkVlan&#34;</span>: {<span style="color:#e6db74">&#34;id&#34;</span>: int(private_vlan)}}})

        quote <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>client[<span style="color:#e6db74">&#39;Billing_Order_Quote&#39;</span>]
        quote_container <span style="color:#f92672">=</span> quote<span style="color:#f92672">.</span>getRecalculatedOrderContainer(id<span style="color:#f92672">=</span>quote_id)
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;================= QUOTE CONTAINER =================&#34;</span>)
        pp(quote_container)
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;================= QUOTE CONTAINER =================&#34;</span>)

        container <span style="color:#f92672">=</span> quote_container
        container[<span style="color:#e6db74">&#39;complexType&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SoftLayer_Container_Product_Order_Virtual_Guest&#34;</span>
        container[<span style="color:#e6db74">&#39;quantity&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>
        container[<span style="color:#e6db74">&#39;virtualGuests&#39;</span>] <span style="color:#f92672">=</span> []
        container[<span style="color:#e6db74">&#39;virtualGuests&#39;</span>]<span style="color:#f92672">.</span>append(guests)
        container[<span style="color:#e6db74">&#39;virtualGuests&#39;</span>]<span style="color:#f92672">.</span>append(guests)

        <span style="color:#75715e"># container[&#39;provisionScripts&#39;] = [&#39;https://gist.githubusercontent.com/myscript.py&#39;]</span>
        sshKeys <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;sshKeyIds&#39;</span>: [<span style="color:#ae81ff">395515</span>, <span style="color:#ae81ff">87634</span>]}
        container[<span style="color:#e6db74">&#39;sshKeys&#39;</span>] <span style="color:#f92672">=</span> [sshKeys, sshKeys]

        <span style="color:#66d9ef">if</span> image_id <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
            container[<span style="color:#e6db74">&#39;imageTemplateId&#39;</span>] <span style="color:#f92672">=</span> image_id

        <span style="color:#66d9ef">if</span> dc_id <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> None:
            container[<span style="color:#e6db74">&#39;location&#39;</span>] <span style="color:#f92672">=</span> dc_id

        <span style="color:#75715e"># result = self.client[&#39;Billing_Order_Quote&#39;].verifyOrder(container, id=quote_id)</span>
        result <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>client[<span style="color:#e6db74">&#39;Billing_Order_Quote&#39;</span>]<span style="color:#f92672">.</span>placeOrder(container, id<span style="color:#f92672">=</span>quote_id)
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;================= RECEIPT CONTAINER =================&#34;</span>)
        pp(result)
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;================= RECEIPT CONTAINER =================&#34;</span>)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">listQuotes</span>(self):
        <span style="color:#75715e"># https://softlayer.github.io/reference/datatypes/SoftLayer_Billing_Order_Quote/</span>
        mask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mask[order[id, orderTotalAmount, orderTopLevelItems[id, description]], ordersFromQuoteCount]&#34;</span>
        quotes <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>client[<span style="color:#e6db74">&#39;SoftLayer_Account&#39;</span>]<span style="color:#f92672">.</span>getActiveQuotes(mask<span style="color:#f92672">=</span>mask)
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;ID, createDate, name, status, order count, description&#34;</span>)
        <span style="color:#66d9ef">for</span> quote <span style="color:#f92672">in</span> quotes:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;{}, {}, {}, {}, {}, {}&#34;</span><span style="color:#f92672">.</span>format(
                quote[<span style="color:#e6db74">&#39;id&#39;</span>], quote[<span style="color:#e6db74">&#39;createDate&#39;</span>], quote[<span style="color:#e6db74">&#39;name&#39;</span>], quote[<span style="color:#e6db74">&#39;status&#39;</span>], 
                quote[<span style="color:#e6db74">&#39;ordersFromQuoteCount&#39;</span>], quote[<span style="color:#e6db74">&#39;order&#39;</span>][<span style="color:#e6db74">&#39;orderTopLevelItems&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;description&#39;</span>])
            )

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">listLocations</span>(self):
        locations <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>client[<span style="color:#e6db74">&#39;SoftLayer_Location&#39;</span>]<span style="color:#f92672">.</span>getDatacenters()
        pp(locations)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">listLocationsForQuote</span>(self, quoteId):
        mask<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;mask[id, order[id, orderTopLevelItems[id, package[id, availableLocations[location[longName, id]]]]]]&#34;</span>
        locations <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>client[<span style="color:#e6db74">&#39;Billing_Order_Quote&#39;</span>]<span style="color:#f92672">.</span>getObject(id<span style="color:#f92672">=</span>quoteId, mask<span style="color:#f92672">=</span>mask)

        package_id <span style="color:#f92672">=</span> locations[<span style="color:#e6db74">&#39;order&#39;</span>][<span style="color:#e6db74">&#39;orderTopLevelItems&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;package&#39;</span>][<span style="color:#e6db74">&#39;id&#39;</span>]
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Package {} is available in the following locations...&#34;</span><span style="color:#f92672">.</span>format(package_id))
        <span style="color:#66d9ef">for</span> dc <span style="color:#f92672">in</span> locations[<span style="color:#e6db74">&#39;order&#39;</span>][<span style="color:#e6db74">&#39;orderTopLevelItems&#39;</span>][<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;package&#39;</span>][<span style="color:#e6db74">&#39;availableLocations&#39;</span>]:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;{}, id={}&#34;</span><span style="color:#f92672">.</span>format(dc[<span style="color:#e6db74">&#39;location&#39;</span>][<span style="color:#e6db74">&#39;longName&#39;</span>], dc[<span style="color:#e6db74">&#39;location&#39;</span>][<span style="color:#e6db74">&#39;id&#39;</span>]))

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">listSshKeys</span>(self):
        keys <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>client[<span style="color:#e6db74">&#39;SoftLayer_Account&#39;</span>]<span style="color:#f92672">.</span>getSshKeys()
        pp(keys)

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">listImageTemplates</span>(self):
        mask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mask[id,name,note]&#34;</span>
        imageTemplates <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>client[<span style="color:#e6db74">&#39;SoftLayer_Account&#39;</span>]<span style="color:#f92672">.</span>getPrivateBlockDeviceTemplateGroups(mask<span style="color:#f92672">=</span>mask)
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;ID - Name - Note&#34;</span>)
        <span style="color:#66d9ef">for</span> template <span style="color:#f92672">in</span> imageTemplates:
            <span style="color:#66d9ef">try</span>:
                <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (template[<span style="color:#e6db74">&#39;id&#39;</span>], template[<span style="color:#e6db74">&#39;name&#39;</span>], template[<span style="color:#e6db74">&#39;note&#39;</span>]))
            <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">KeyError</span>:
                <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (template[<span style="color:#e6db74">&#39;id&#39;</span>], template[<span style="color:#e6db74">&#39;name&#39;</span>], <span style="color:#e6db74">&#39;None&#39;</span>))

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">listVlansInLocation</span>(self, location_id):
        mask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mask[id,vlanNumber,primaryRouter[hostname,datacenter[id,name]]]&#34;</span>
        objfilter2 <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#34;networkVlans&#34;</span>:    
                        {<span style="color:#e6db74">&#34;primaryRouter&#34;</span>: 
                            {<span style="color:#e6db74">&#34;datacenter&#34;</span>: { <span style="color:#e6db74">&#34;id&#34;</span> : {<span style="color:#e6db74">&#34;operation&#34;</span>:location_id} } }
                        }
                    }
        subnets <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>client[<span style="color:#e6db74">&#39;SoftLayer_Account&#39;</span>]<span style="color:#f92672">.</span>getNetworkVlans(mask<span style="color:#f92672">=</span>mask,filter<span style="color:#f92672">=</span>objfilter2)
        <span style="color:#66d9ef">for</span> subnet <span style="color:#f92672">in</span> subnets:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> ( subnet[<span style="color:#e6db74">&#39;id&#39;</span>], subnet[<span style="color:#e6db74">&#39;vlanNumber&#39;</span>], subnet[<span style="color:#e6db74">&#39;primaryRouter&#39;</span>][<span style="color:#e6db74">&#39;hostname&#39;</span>]))

    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">debug</span>(self):
        <span style="color:#66d9ef">for</span> call <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>transport<span style="color:#f92672">.</span>get_last_calls():
            <span style="color:#66d9ef">print</span>(self<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>transport<span style="color:#f92672">.</span>print_reproduceable(call))


<span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
    quote_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1528487</span>
    main <span style="color:#f92672">=</span> example()
    <span style="color:#75715e"># main.listImageTemplates()</span>
    <span style="color:#75715e"># main.listQuotes()</span>
    <span style="color:#75715e"># main.listLocationsForQuote(quote_id)</span>
    <span style="color:#75715e"># main.listLocations()</span>
    dal13 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1854895</span>
    ams03 <span style="color:#f92672">=</span> <span style="color:#ae81ff">814994</span>
    dal09 <span style="color:#f92672">=</span> <span style="color:#ae81ff">449494</span>
    <span style="color:#75715e"># main.listSshKeys()</span>
    <span style="color:#75715e"># main.listVlansInLocation(dal13)</span>
    backend_vlan <span style="color:#f92672">=</span> <span style="color:#ae81ff">2068355</span> <span style="color:#75715e">#951, bcr01a.dal13</span>
    front_vlan <span style="color:#f92672">=</span> <span style="color:#ae81ff">2068353</span> <span style="color:#75715e"># 907, fcr01a.dal13</span>
    main<span style="color:#f92672">.</span>orderQuote(quote_id, dc_id<span style="color:#f92672">=</span>dal13, public_vlan<span style="color:#f92672">=</span>front_vlan,private_vlan<span style="color:#f92672">=</span>backend_vlan)
    main<span style="color:#f92672">.</span>debug()
</code></pre></div><h4 id="notes">Notes</h4>
<p>When placing an order from a quote, it is important to note the following.</p>
<ol>
<li>Use the <code>Billing_Order_Quote</code> service, NOT The <code>Product_Order</code> service.</li>
<li>Make sure your container that is sent to placeOrder contains the <a href="https://sldn.softlayer.com/reference/datatypes/SoftLayer_Container_Product_Order/#billingorderitemid"><code>billingOrderItemId </code></a> is set. This will usually be returned from the Billing_Order_Quote::getRecalculatedOrderContainer() API call. But if it is removed, the order you place will not be tracked as being placed from a quote.</li>
</ol>

            </div>
        </div>

    </div>
    <hr>
    <div class="row">
            
        <div class="col-md-6">
            
<div class="panel panel-default">
    <div class="panel-heading" style="padding: 2px 15px;">
        <h4>More Documentation</h4>
    </div>
    <div class="panel-body">
        <a href="https://softlayer.github.com/reference/softlayerapi"><i class="fa fa-link"></i> SoftLayer API Reference<br></a>
        <a href="https://github.com/softlayer/softlayer-java"><i class="fab fa-github"></i> softlayer-java<br></a>
        <a href="https://github.com/softlayer/softlayer-api-perl-client"><i class="fab fa-github"></i> softlayer-perl<br></a>
        <a href="https://github.com/softlayer/softlayer-api-php-client"><i class="fab fa-github"></i> softlayer-php<br></a>
        <a href="https://github.com/softlayer/softlayer-python"><i class="fab fa-github"></i> softlayer-python<br></a>
        <a href="https://github.com/softlayer/softlayer-ruby"><i class="fab fa-github"></i> softlayer-ruby<br></a>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading text-center" style="padding: 2px 15px;">
      <a href="https://www.facebook.com/IBMBluemixIaaS/"><i class="fab fa-facebook-square" alt="facebook"></i> </a>
      <a href="https://twitter.com/IBMBluemixIaaS"><i class="fab fa-twitter" alt="twitter"></i> </a>
      <a href="http://www.linkedin.com/company/softlayer-technologies-inc-" alt="linked-in"><i class="fab fa-linkedin"></i> </a>
      <a href="https://github.com/softlayer/softlayer.github.io"><i class="fab fa-github" alt="github"></i> </a>

    </div>
</div>

        </div>
        <div class="col-md-6">
            <div class="well well-sm" style="word-wrap: break-word;"> 
                <strong>Feedback? <span class="fa fa-comment"/></strong>
                    <p>
                        We would love to hear it<br>
                        <a class="" href="https://github.com/softlayer/api_examples/issues/new?title=Feedback%20for%20python%20-%20Advanced%20Quote%20Ordering&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2fpython%2forder_quote_advanced%2f"><span class="fa fa-github-square"/> Open an issue</a>
                    </p>
            </div>
        </div>

    </div>
        <footer>
            <div class="row">
                <hr>
                <div class="col-sm-12">
                    <p>&copy; SoftLayer 2015<br>
                    Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
                </div>
            </div>
        </footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>
