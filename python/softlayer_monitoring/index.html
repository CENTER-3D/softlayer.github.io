<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Monitoring Agent Management - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/python/softlayer_monitoring/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/fa-svg-with-js.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>
    <script src="https://sldn.softlayer.com/js/fontawesome-all.js"></script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-88235803-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/perl/">Perl</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>November 23, 2017<br></h4>
            </div>
        </div>
        <div class="col-md-9">

                <strong>Classes <span class="fa fa-book"/></strong>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent">SoftLayer_Monitoring_Agent</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent_Configuration_Template_Group">SoftLayer_Monitoring_Agent_Configuration_Template_Group</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Configuration_Template">SoftLayer_Configuration_Template</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest">SoftLayer_Virtual_Guest</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_User_Customer">SoftLayer_User_Customer</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent_Configuration_Value">SoftLayer_Monitoring_Agent_Configuration_Value</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server">SoftLayer_Hardware_Server</a>
                
                    <a class="label label-primary" href="https://sldn.softlayer.com/reference/services/SoftLayer_Container_Metric_Data_Type">SoftLayer_Container_Metric_Data_Type</a>
                
                <br>
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/monitoring">monitoring</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
		<div class="col-md-12">
            <div class="well well-sm  article" style="word-wrap: break-word;">
                <div class="article-title">
				    <h1>Monitoring Agent Management</h1>
                    <small>A collection of examples on how to interact with the Monitoring Agent</small>
                </div>
				
                
				
                <p>ResponseStatus codes and what they mean.</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Monitor_Version1_Query_Result">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Network_Monitor_Version1_Query_Result</a></li>
</ul>
<ul>
<li>0: CRITICAL</li>
<li>1: Warning</li>
<li>2: OK</li>
<li>4 - 5: Unknown Status, Contact Support</li>
</ul>
<h3 id="ordering-monitoring">Ordering Monitoring</h3>
<p>Build a SoftLayer_Container_Product_Order_Monitoring_Package object for a new
monitoring order and pass it to the SoftLayer_Product_Order API service to order it
In this care we&rsquo;ll order a Basic (Hardware and OS) package with Basic Monitoring Package - Linux configuration.</p>
<p>Important manual pages:</p>
<ul>
<li><a href="https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Monitoring_Package">https://softlayer.github.io/reference/datatypes/SoftLayer_Container_Product_Order_Monitoring_Package</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Product_Order/verifyOrder">http://sldn.softlayer.com/reference/services/SoftLayer_Product_Order/verifyOrder</a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Template_Group">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Template_Group</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Order a Monitoring Package
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#f92672">import</span> SoftLayer

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Build a skeleton SoftLayer_Container_Product_Order_Monitoring_Package object
</span><span style="color:#e6db74">containing the order you wish to place.
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
oderTemplate <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;complexType&#39;</span>: <span style="color:#e6db74">&#39;SoftLayer_Container_Product_Order_Monitoring_Package&#39;</span>,
    <span style="color:#e6db74">&#39;packageId&#39;</span>: <span style="color:#ae81ff">0</span>,  <span style="color:#75715e"># the packageID for order monitoring packages is 0</span>
    <span style="color:#e6db74">&#39;prices&#39;</span>: [
        {<span style="color:#e6db74">&#39;id&#39;</span>: <span style="color:#ae81ff">2302</span>}  <span style="color:#75715e"># this is the price for Monitoring Package - Basic ((Hardware and OS))</span>
    ],
    <span style="color:#e6db74">&#39;quantity&#39;</span>: <span style="color:#ae81ff">0</span>,  <span style="color:#75715e"># the quantity for order a service (in this case monitoring package) must be 0</span>
    <span style="color:#e6db74">&#39;sendQuoteEmailFlag&#39;</span>: True,
    <span style="color:#e6db74">&#39;useHourlyPricing&#39;</span>: True,
    <span style="color:#e6db74">&#39;virtualGuests&#39;</span>: [
        {<span style="color:#e6db74">&#39;id&#39;</span>: <span style="color:#ae81ff">4906034</span>}  <span style="color:#75715e"># the virtual guest ID where you want add the monitoring package</span>
    ],
    <span style="color:#e6db74">&#39;configurationTemplateGroups&#39;</span>: [
        {<span style="color:#e6db74">&#39;id&#39;</span>: <span style="color:#ae81ff">3</span>}  <span style="color:#75715e"># the templateID for the monitoring group (in this case Basic Monitoring package for Unix/Linux operating system.)</span>
    ]
}

<span style="color:#75715e"># Declare the API client to use the SoftLayer_Product_Order API service</span>
client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
productOrderService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Product_Order&#39;</span>]

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">verifyOrder() will check your order for errors. Replace this with a call to
</span><span style="color:#e6db74">placeOrder() when you&#39;re ready to order. Both calls return a receipt object
</span><span style="color:#e6db74">that you can use for your records.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">Once your order is placed it&#39;ll go through SoftLayer&#39;s provisioning process.
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

order <span style="color:#f92672">=</span> productOrderService<span style="color:#f92672">.</span>verifyOrder(oderTemplate)
<span style="color:#66d9ef">print</span>(order)

</code></pre></div><h3 id="activate-monitoring-agent">Activate Monitoring Agent</h3>
<p>Important manual pages:</p>
<ul>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">https://softlayer.github.io/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Monitoring_Agent/activate">https://softlayer.github.io/reference/services/SoftLayer_Monitoring_Agent/activate</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Active an agent.
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">import</span> SoftLayer
<span style="color:#f92672">import</span> json

vsiIp <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;169.45.98.148&#34;</span>
agentName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DHCP Response Monitoring Agent&#34;</span>


client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
vsiService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Virtual_Guest&#39;</span>]
agentService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]


objectMask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mask[monitoringRobot[id, robotStatus[name]], monitoringAgents[statusName, name, id], monitoringServiceEligibilityFlag, datacenter]&#34;</span>
vsi <span style="color:#f92672">=</span> vsiService<span style="color:#f92672">.</span>findByIpAddress(vsiIp, mask<span style="color:#f92672">=</span>objectMask)
<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> vsi:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;There is not a vsi with the IP address: &#34;</span> <span style="color:#f92672">+</span> vsiIp)
    exit(<span style="color:#ae81ff">1</span>)
agent <span style="color:#f92672">=</span> {}
<span style="color:#66d9ef">for</span> agents <span style="color:#f92672">in</span> vsi[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>]:
    <span style="color:#66d9ef">if</span> agents[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> agentName<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper():
        agent <span style="color:#f92672">=</span> agents
        <span style="color:#66d9ef">break</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> agent:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;The VSI does not have a monitor agent with the name: &#34;</span> <span style="color:#f92672">+</span>  agentName)
    exit(<span style="color:#ae81ff">1</span>)
result <span style="color:#f92672">=</span> agentService<span style="color:#f92672">.</span>activate(id<span style="color:#f92672">=</span>agent[<span style="color:#e6db74">&#39;id&#39;</span>])
<span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>dumps(result, sort_keys<span style="color:#f92672">=</span>True, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, separators<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;: &#39;</span>)))

</code></pre></div><h3 id="addremove-monitoring-subscriber">Add/Remove Monitoring Subscriber</h3>
<p>The scripts adds subscribers to an arbitrary VSI machine.</p>
<p>Important manual pages:</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/getMonitoringAgents">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/getMonitoringAgents</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getEligibleAlarmSubscibers">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getEligibleAlarmSubscibers</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/setActiveAlarmSubscriber">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/setActiveAlarmSubscriber</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Add subscribers to a monitor
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#f92672">import</span> SoftLayer

hostnames <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;rctest&#34;</span>, <span style="color:#e6db74">&#34;rctest2&#34;</span>]
mailsToAdd <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#34;someone@test.com&#34;</span>, <span style="color:#e6db74">&#34;someone.else@test.com&#34;</span>]

client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
<span style="color:#75715e"># Getting all virtual servers on the account</span>
vServers <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;Account&#39;</span>]<span style="color:#f92672">.</span>getVirtualGuests()
<span style="color:#66d9ef">for</span> hostname <span style="color:#f92672">in</span> hostnames:
    <span style="color:#66d9ef">for</span> vServer <span style="color:#f92672">in</span> vServers:
        <span style="color:#66d9ef">if</span> hostname <span style="color:#f92672">==</span> vServer[<span style="color:#e6db74">&#39;hostname&#39;</span>]:
            vSertverId <span style="color:#f92672">=</span> vServer[<span style="color:#e6db74">&#39;id&#39;</span>]
            <span style="color:#75715e"># Getting all the agents in the virtual machine</span>
            agents <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;Virtual_Guest&#39;</span>]<span style="color:#f92672">.</span>getMonitoringAgents(id<span style="color:#f92672">=</span>vSertverId)
            <span style="color:#66d9ef">for</span> agent <span style="color:#f92672">in</span> agents:
                agentId <span style="color:#f92672">=</span> agent[<span style="color:#e6db74">&#39;id&#39;</span>]
                agentName <span style="color:#f92672">=</span> agent[<span style="color:#e6db74">&#39;name&#39;</span>]
                elegibleSubscribers <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]<span style="color:#f92672">.</span>getEligibleAlarmSubscibers(id<span style="color:#f92672">=</span>agentId)
                <span style="color:#66d9ef">for</span> mailToAdd <span style="color:#f92672">in</span> mailsToAdd:
                    <span style="color:#66d9ef">for</span> elegibleSubscriber <span style="color:#f92672">in</span> elegibleSubscribers:
                        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> elegibleSubscriber:
                            suscriberId <span style="color:#f92672">=</span> elegibleSubscriber[<span style="color:#e6db74">&#39;id&#39;</span>]
                            userData <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_User_Customer&#39;</span>]<span style="color:#f92672">.</span>getObject(id<span style="color:#f92672">=</span>suscriberId)
                            <span style="color:#66d9ef">if</span> mailToAdd<span style="color:#f92672">.</span>strip() <span style="color:#f92672">==</span> userData[<span style="color:#e6db74">&#39;email&#39;</span>]<span style="color:#f92672">.</span>strip():
                                added <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]<span style="color:#f92672">.</span>setActiveAlarmSubscriber(suscriberId, id<span style="color:#f92672">=</span>agentId)
                                <span style="color:#75715e"># Use this to Remove </span>
                                <span style="color:#75715e"># removed = client[&#39;SoftLayer_Monitoring_Agent&#39;].removeActiveAlarmSubscriber(suscriberId, id=agentId)</span>
                                <span style="color:#66d9ef">if</span> added:
                                    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;For hostname: &#34;</span> <span style="color:#f92672">+</span> hostname <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; with ID &#34;</span> <span style="color:#f92672">+</span> str(vSertverId) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; in the agent for &#34;</span> <span style="color:#f92672">+</span> agentName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; the mail &#34;</span> <span style="color:#f92672">+</span> mailToAdd <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; has been added.&#34;</span>)
                                <span style="color:#66d9ef">else</span>:
                                    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;ERROR - For hostname: &#34;</span> <span style="color:#f92672">+</span> hostname <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; with ID &#34;</span> <span style="color:#f92672">+</span> str(vSertverId) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; in the agent for &#34;</span> <span style="color:#f92672">+</span> agentName <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; the mail &#34;</span> <span style="color:#f92672">+</span> mailToAdd <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; has not been added.&#34;</span>)



</code></pre></div><h3 id="clone-monitoring-configuration">Clone monitoring configuration</h3>
<p>The script clones an existing configuration template, performs a change in the
configuration template, then creates a template group and adds the created
configuration template to the new template group.</p>
<p>Important manual pages:</p>
<ul>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Configuration_Template">https://softlayer.github.io/reference/services/SoftLayer_Configuration_Template</a></li>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Monitoring_Agent_Configuration_Template_Group">https://softlayer.github.io/reference/services/SoftLayer_Monitoring_Agent_Configuration_Template_Group</a></li>
<li><a href="https://softlayer.github.io/reference/services/SoftLayer_Product_Package">https://softlayer.github.io/reference/services/SoftLayer_Product_Package</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Create a monitoring configuration template and a template group
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#f92672">import</span> SoftLayer


client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
configurationTemplateService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Configuration_Template&#39;</span>]
monitoringAgentConfigurationTemplateGroupService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent_Configuration_Template_Group&#39;</span>]
productPackageService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Product_Package&#39;</span>]

templates <span style="color:#f92672">=</span> configurationTemplateService<span style="color:#f92672">.</span>getAllObjects(limit<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>, offset<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
newTemplateId <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">for</span> template <span style="color:#f92672">in</span> templates:
    <span style="color:#66d9ef">if</span> template[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;CDM Monitoring agent-MH-Linux v2&#39;</span>:
        <span style="color:#75715e"># Creating an Skeleton SoftLayer_Configuration_Template for our new template</span>
        templateObject <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">&#39;this is my clone test&#39;</span>,
            <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;clone for test&#39;</span>,
            <span style="color:#e6db74">&#39;parentId&#39;</span>: template[<span style="color:#e6db74">&#39;id&#39;</span>]
        }
        newTemplate <span style="color:#f92672">=</span> configurationTemplateService<span style="color:#f92672">.</span>copyTemplate(templateObject, id<span style="color:#f92672">=</span>template[<span style="color:#e6db74">&#39;id&#39;</span>])
        <span style="color:#75715e"># Getting the definitions from the parent template to set in the new template e.g. CPU, Memory</span>
        objectMask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mask[configurationSections[subSections[definitions]]]&#39;</span>
        definitions <span style="color:#f92672">=</span> configurationTemplateService<span style="color:#f92672">.</span>getObject(mask<span style="color:#f92672">=</span>objectMask, id<span style="color:#f92672">=</span>template[<span style="color:#e6db74">&#39;id&#39;</span>])

        <span style="color:#75715e"># The configuration values for our new template</span>
        configurationValues <span style="color:#f92672">=</span> []

        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">        We are going to define the configuration for our template by default it has the
</span><span style="color:#e6db74">        same configuration as the parent template.
</span><span style="color:#e6db74">        we are looking a determinate configuration section in this case CPU section.
</span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
        <span style="color:#66d9ef">for</span> definition <span style="color:#f92672">in</span> definitions[<span style="color:#e6db74">&#39;configurationSections&#39;</span>]:
            <span style="color:#66d9ef">if</span> definition[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;CPU&#39;</span>:
                <span style="color:#75715e"># We are looking for the subsection Graphing.</span>
                <span style="color:#66d9ef">for</span> subsection <span style="color:#f92672">in</span> definition[<span style="color:#e6db74">&#39;subSections&#39;</span>]:
                    <span style="color:#66d9ef">if</span> subsection[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Graphing&#39;</span>:
                        <span style="color:#66d9ef">for</span> subdefinition <span style="color:#f92672">in</span> subsection[<span style="color:#e6db74">&#39;definitions&#39;</span>]:
                            <span style="color:#75715e"># We are looking the &#39;Graph Total CPU Usage&#39; configuration option.</span>
                            <span style="color:#66d9ef">if</span> subdefinition[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Graph Total CPU Usage&#39;</span>:
                                <span style="color:#75715e"># Setting the configuration for our template</span>
                                configurationValues<span style="color:#f92672">.</span>append({<span style="color:#e6db74">&#34;definitionId&#34;</span>: subdefinition[<span style="color:#e6db74">&#39;id&#39;</span>], <span style="color:#e6db74">&#34;templateId&#34;</span>: template[<span style="color:#e6db74">&#39;id&#39;</span>], <span style="color:#e6db74">&#34;value&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>})

        <span style="color:#66d9ef">print</span>(configurationValues)
        <span style="color:#75715e"># Updating the new configuration in our created template</span>
        result <span style="color:#f92672">=</span> configurationTemplateService<span style="color:#f92672">.</span>updateDefaultValues(configurationValues, id<span style="color:#f92672">=</span>newTemplate[<span style="color:#e6db74">&#39;id&#39;</span>])
        newTemplateId <span style="color:#f92672">=</span> newTemplate[<span style="color:#e6db74">&#39;id&#39;</span>]
        <span style="color:#66d9ef">print</span>(result)


<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Looking for a monitoring package in order to add our new template group
</span><span style="color:#e6db74">in that monitoring package. In this case we are going to add it to
</span><span style="color:#e6db74">&#34;Monitoring Package - Basic&#34;
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
monitoringBasicId <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
itemsPackage <span style="color:#f92672">=</span> productPackageService<span style="color:#f92672">.</span>getItems(id<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
<span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> itemsPackage:
    <span style="color:#66d9ef">if</span> item[<span style="color:#e6db74">&#39;description&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Monitoring Package - Basic&#34;</span>:
        monitoringBasicId <span style="color:#f92672">=</span> item[<span style="color:#e6db74">&#39;id&#39;</span>]
        <span style="color:#66d9ef">break</span>

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">To create a template group in &#34;Monitoring package - Basic&#34;
</span><span style="color:#e6db74">is necessary to specific a configuration template for
</span><span style="color:#e6db74">Cpu, Disk, and Memory Monitoring Agent
</span><span style="color:#e6db74">Process Monitoring Agent
</span><span style="color:#e6db74">Windows Services Monitoring Agent
</span><span style="color:#e6db74">Remote System Monitoring Agent
</span><span style="color:#e6db74">we are going to look for the IDs for those configuration templates
</span><span style="color:#e6db74">except for &#34;Cpu, Disk, and Memory Monitoring Agent&#34;, for this we are going
</span><span style="color:#e6db74">to use the template that we created above
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
templates <span style="color:#f92672">=</span> configurationTemplateService<span style="color:#f92672">.</span>getAllObjects(limit<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>, offset<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)
cpuDiskMemoryMonitoringAgent <span style="color:#f92672">=</span> newTemplateId
processMonitoringAgent <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
windowsServiceMonitoringAgent <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
remoteMonitoringAgent <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">for</span> template <span style="color:#f92672">in</span> templates:
    <span style="color:#66d9ef">if</span> template[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Process Monitoring Agent &#34;</span>:
        proccesMonitoringAgent <span style="color:#f92672">=</span> template[<span style="color:#e6db74">&#39;id&#39;</span>]
    <span style="color:#66d9ef">if</span> template[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Windows Services Monitoring Agent&#34;</span>:
        windowsServiceMonitoringAgent <span style="color:#f92672">=</span> template[<span style="color:#e6db74">&#39;id&#39;</span>]
    <span style="color:#66d9ef">if</span> template[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Remote system monitoring agent - Linux V1&#34;</span>:
        remoteMonitoringAgent <span style="color:#f92672">=</span> template[<span style="color:#e6db74">&#39;id&#39;</span>]

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Creating an skeleton SoftLayer_Monitoring_Agent_Configuration_Template_Group for our
</span><span style="color:#e6db74">new template group
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
templateObject <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;description&#34;</span>: <span style="color:#e6db74">&#34;this is my template group test&#34;</span>,
    <span style="color:#e6db74">&#34;itemId&#34;</span>: monitoringBasicId,
    <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;my template group test&#34;</span>,
    <span style="color:#e6db74">&#34;configurationTemplateReferences&#34;</span>: [
        {<span style="color:#e6db74">&#34;configurationTemplateId&#34;</span>: newTemplateId},
        {<span style="color:#e6db74">&#34;configurationTemplateId&#34;</span>: processMonitoringAgent},
        {<span style="color:#e6db74">&#34;configurationTemplateId&#34;</span>: windowsServiceMonitoringAgent},
        {<span style="color:#e6db74">&#34;configurationTemplateId&#34;</span>: remoteMonitoringAgent}
    ]
}

<span style="color:#66d9ef">try</span>:
    result <span style="color:#f92672">=</span> monitoringAgentConfigurationTemplateGroupService<span style="color:#f92672">.</span>createObject(templateObject)
    <span style="color:#66d9ef">print</span>(result)

<span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to create the object template for the monitoring agent. &#34;</span>
          <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
    exit(<span style="color:#ae81ff">1</span>)

</code></pre></div><h3 id="configure-monitoring-agent">Configure Monitoring Agent</h3>
<p>Important manual pages</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/applyConfigurationValues">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/applyConfigurationValues</a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Configure the section &#39;CPU&#39; from the &#39;Cpu, Disk, and Memory Monitoring Agent&#39; agent.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">import</span> SoftLayer
<span style="color:#f92672">import</span> json

<span style="color:#75715e"># The IP address of the server or VSI to configure.</span>
ipAddres <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;23.246.195.66&#34;</span>

configuration <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;Graph System CPU Usage&#39;</span>: <span style="color:#e6db74">&#34;False&#34;</span>,
    <span style="color:#e6db74">&#39;Graph Total CPU Usage&#39;</span>: <span style="color:#e6db74">&#34;False&#34;</span>,
    <span style="color:#e6db74">&#39;Graph User CPU Usage&#39;</span>: <span style="color:#e6db74">&#34;True&#34;</span>,
    <span style="color:#e6db74">&#39;Graph I/O Wait CPU Usage&#39;</span>: <span style="color:#e6db74">&#34;True&#34;</span>,
    <span style="color:#e6db74">&#39;Processor Queue Length Alarm&#39;</span>: <span style="color:#e6db74">&#34;True&#34;</span>,
    <span style="color:#e6db74">&#39;CPU Usage Error Alarm&#39;</span>: <span style="color:#e6db74">&#34;True&#34;</span>,
    <span style="color:#e6db74">&#39;CPU Usage Error Alarm Threshold&#39;</span>: <span style="color:#e6db74">&#34;99&#34;</span>,
    <span style="color:#e6db74">&#39;CPU Usage Warning Alarm&#39;</span>: <span style="color:#e6db74">&#34;True&#34;</span>,
    <span style="color:#e6db74">&#39;CPU Usage Warning Alarm Threshold&#39;</span>: <span style="color:#e6db74">&#34;82&#34;</span>,
    <span style="color:#e6db74">&#39;Processor Queue Length Alarm&#39;</span>: <span style="color:#e6db74">&#34;True&#34;</span>,
    <span style="color:#e6db74">&#39;Max Queue Length&#39;</span>: <span style="color:#e6db74">&#34;4&#34;</span>
}

<span style="color:#75715e"># The agent&#39;s name we wish to configure.</span>
agentName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Cpu, Disk, and Memory Monitoring Agent&#39;</span>

client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
vsiService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Virtual_Guest&#39;</span>]
hardwareService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Hardware_Server&#39;</span>]
monitoringService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]

<span style="color:#75715e"># Getting the monitoring agents installed in the server or VSI.</span>
<span style="color:#66d9ef">try</span>:
    objectMask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mask[monitoringAgents[configurationValues[definition]]]&#39;</span>
    server <span style="color:#f92672">=</span> vsiService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
        server <span style="color:#f92672">=</span> hardwareService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span style="color:#f92672">+</span> ipAddres)
            exit(<span style="color:#ae81ff">1</span>)
<span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to get the server: faultCode=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, faultString=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
          <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
    exit(<span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Getting the agent to configure.</span>
agents <span style="color:#f92672">=</span> [agent <span style="color:#66d9ef">for</span> agent <span style="color:#f92672">in</span> server[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>] <span style="color:#66d9ef">if</span> agent[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> agentName]
<span style="color:#66d9ef">if</span> len(agents) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to find the agent: &#34;</span> <span style="color:#f92672">+</span> agentName)
    exit(<span style="color:#ae81ff">1</span>)
agent <span style="color:#f92672">=</span> agents[<span style="color:#ae81ff">0</span>]

<span style="color:#75715e"># Creating an SoftLayer_Monitoring_Agent_Configuration_Value skeleton</span>
<span style="color:#75715e"># which contains the configuration for the agent.</span>
configurationValues <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> configuration<span style="color:#f92672">.</span>keys():
    itemFound <span style="color:#f92672">=</span> False
    <span style="color:#66d9ef">for</span> value <span style="color:#f92672">in</span> agent[<span style="color:#e6db74">&#39;configurationValues&#39;</span>]:
        <span style="color:#66d9ef">if</span> value[<span style="color:#e6db74">&#39;definition&#39;</span>][<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> item<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper():
            itemFound <span style="color:#f92672">=</span> True
            configurationValue <span style="color:#f92672">=</span> value
            configurationValue[<span style="color:#e6db74">&#39;value&#39;</span>] <span style="color:#f92672">=</span> configuration[item]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper()
            configurationValues<span style="color:#f92672">.</span>append(configurationValue)
            <span style="color:#66d9ef">break</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> itemFound:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;The configuration: &#34;</span> <span style="color:#f92672">+</span> item <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is not available for the agent.&#34;</span>)


<span style="color:#75715e"># Calling the SoftLayer_Monitoring_Agent::applyConfigurationValues method</span>
<span style="color:#75715e"># to apply the changes in the agent.</span>
<span style="color:#75715e"># Note: In case there is no changes in the agent configuration the method</span>
<span style="color:#75715e"># will return error.</span>
<span style="color:#66d9ef">try</span>:
    result <span style="color:#f92672">=</span> monitoringService<span style="color:#f92672">.</span>applyConfigurationValues(configurationValues, id<span style="color:#f92672">=</span>agent[<span style="color:#e6db74">&#39;id&#39;</span>])
    <span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>dumps(result, sort_keys<span style="color:#f92672">=</span>True, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, separators<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;: &#39;</span>)))
<span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to apply the configuration in the monitoring agent: faultCode=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, faultString=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
          <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
    exit(<span style="color:#ae81ff">1</span>)

</code></pre></div><h3 id="configure-new-agent-disk-profile">Configure new agent disk profile</h3>
<p>Important manual pages</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/addConfigurationProfile">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/addConfigurationProfile</a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Create a new &#39;Disk Profile&#39; configuration for the &#39;Cpu, Disk, and Memory Monitoring Agent&#39; agent.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">import</span> SoftLayer
<span style="color:#f92672">import</span> json

<span style="color:#75715e"># The IP address of the server or VSI to configure.</span>
ipAddres <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;23.246.195.66&#34;</span>

configuration <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;Disk Path&#39;</span>: <span style="color:#e6db74">&#34;c:/&#34;</span>,
    <span style="color:#e6db74">&#39;Description&#39;</span>: <span style="color:#e6db74">&#34;file system c:/&#34;</span>,
    <span style="color:#e6db74">&#39;Graph Disk Usage&#39;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#39;Graph Disk Usage as Percentage&#39;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#39;Disk Usage Error Alarm&#39;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#39;Usage Error Alarm Threshold&#39;</span>: <span style="color:#e6db74">&#34;90&#34;</span>,
    <span style="color:#e6db74">&#39;Disk Usage Warning Alarm&#39;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#39;Disk Usage Warning Threshold&#39;</span>: <span style="color:#e6db74">&#34;90&#34;</span>,
}

<span style="color:#75715e"># The agent&#39;s name we wish to configure.</span>
agentName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Cpu, Disk, and Memory Monitoring Agent&#39;</span>
<span style="color:#75715e"># The agent&#39;s section we wish to change</span>
sectionName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Disk Profile&#34;</span>

client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
vsiService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Virtual_Guest&#39;</span>]
hardwareService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Hardware_Server&#39;</span>]
monitoringService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]

<span style="color:#75715e"># Getting the monitoring agents installed in the server or VSI.</span>
<span style="color:#66d9ef">try</span>:
    objectMask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mask[monitoringAgents[configurationTemplate[configurationSections[subSections[definitions]]]]]&#39;</span>
    server <span style="color:#f92672">=</span> vsiService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
        server <span style="color:#f92672">=</span> hardwareService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span style="color:#f92672">+</span> ipAddres)
            exit(<span style="color:#ae81ff">1</span>)
<span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to get the server: faultCode=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, faultString=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
          <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
    exit(<span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Getting the agent to configure.</span>
agents <span style="color:#f92672">=</span> [agent <span style="color:#66d9ef">for</span> agent <span style="color:#f92672">in</span> server[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>] <span style="color:#66d9ef">if</span> agent[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> agentName]
<span style="color:#66d9ef">if</span> len(agents) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to find the agent: &#34;</span> <span style="color:#f92672">+</span> agentName)
    exit(<span style="color:#ae81ff">1</span>)
agent <span style="color:#f92672">=</span> agents[<span style="color:#ae81ff">0</span>]

<span style="color:#75715e"># Getting the section to configure</span>
sections <span style="color:#f92672">=</span> [section <span style="color:#66d9ef">for</span> section <span style="color:#f92672">in</span> agent[<span style="color:#e6db74">&#39;configurationTemplate&#39;</span>][<span style="color:#e6db74">&#39;configurationSections&#39;</span>] <span style="color:#66d9ef">if</span> section[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> sectionName]
<span style="color:#66d9ef">if</span> len(sections) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to find the section: &#34;</span> <span style="color:#f92672">+</span> sectionName)
    exit(<span style="color:#ae81ff">1</span>)
section <span style="color:#f92672">=</span> sections[<span style="color:#ae81ff">0</span>]


<span style="color:#75715e"># Creating the configuration for the agent.</span>
configurationValues <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> configuration<span style="color:#f92672">.</span>keys():
    itemConfigured <span style="color:#f92672">=</span> False
    <span style="color:#66d9ef">for</span> subsection <span style="color:#f92672">in</span> section[<span style="color:#e6db74">&#39;subSections&#39;</span>]:
        <span style="color:#66d9ef">for</span> definition <span style="color:#f92672">in</span> subsection[<span style="color:#e6db74">&#39;definitions&#39;</span>]:
            <span style="color:#66d9ef">if</span> definition[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> item<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper():
                configurationValue <span style="color:#f92672">=</span> {}
                itemConfigured <span style="color:#f92672">=</span> True
                configurationValue[<span style="color:#e6db74">&#39;configurationDefinitionId&#39;</span>] <span style="color:#f92672">=</span> definition[<span style="color:#e6db74">&#39;id&#39;</span>]
                configurationValue[<span style="color:#e6db74">&#39;agentId&#39;</span>] <span style="color:#f92672">=</span> agent[<span style="color:#e6db74">&#39;id&#39;</span>]
                configurationValue[<span style="color:#e6db74">&#39;value&#39;</span>] <span style="color:#f92672">=</span> configuration[item]
                configurationValues<span style="color:#f92672">.</span>append(configurationValue)
        <span style="color:#66d9ef">if</span> itemConfigured:
            <span style="color:#66d9ef">break</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> itemConfigured:
        <span style="color:#66d9ef">print</span> (<span style="color:#e6db74">&#34;Unable to configure: &#34;</span> <span style="color:#f92672">+</span> item <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; the configuration name was not found.&#34;</span>)

<span style="color:#75715e"># Calling the SoftLayer_Monitoring_Agent::applyConfigurationValues method</span>
<span style="color:#75715e"># to apply the changes in the agent.</span>
<span style="color:#66d9ef">try</span>:
    result <span style="color:#f92672">=</span> monitoringService<span style="color:#f92672">.</span>addConfigurationProfile(configurationValues, id<span style="color:#f92672">=</span>agent[<span style="color:#e6db74">&#39;id&#39;</span>])
    <span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>dumps(result, sort_keys<span style="color:#f92672">=</span>True, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, separators<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;: &#39;</span>)))
<span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to apply the configuration in the monitoring agent: faultCode=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, faultString=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
          <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
    exit(<span style="color:#ae81ff">1</span>)

</code></pre></div><h3 id="configure-agent-memory-profile">Configure Agent Memory Profile</h3>
<p>Important manual pages</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/applyConfigurationValues">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/applyConfigurationValues</a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Configure the section &#39;Memory&#39; from the &#39;Cpu, Disk, and Memory Monitoring Agent&#39; agent.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#f92672">import</span> SoftLayer
<span style="color:#f92672">import</span> json

<span style="color:#75715e"># The IP address of the server or VSI to configure.</span>
ipAddres <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;5.153.59.197&#34;</span>

configuration <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#34;Graph Memory Usage&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Graph Memory Usage as Percentage&#34;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#34;Graph Physical Memory Usage&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Graph Physical Memory Usage as Percentage&#34;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#34;Graph Swap Memory Usage&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Graph Swap Memory Usage as Percentage&#34;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#34;Graph System Paging in Kb/s&#34;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#34;Graph System Paging in Pg/s&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Total Memory Usage Error Alarm&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Total Memory Usage Error Threshold&#34;</span>: <span style="color:#e6db74">&#34;90&#34;</span>,
    <span style="color:#e6db74">&#34;Total Memory Usage Warning Alarm&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Total Memory Usage Warning Threshold&#34;</span>: <span style="color:#e6db74">&#34;50&#34;</span>,
    <span style="color:#e6db74">&#34;Physical Memory Usage Error Alarm&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Physical Memory Usage Error Threshold&#34;</span>: <span style="color:#e6db74">&#34;95&#34;</span>,
    <span style="color:#e6db74">&#34;Physical Memory Usage Warning Alarm&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Physical Memory Usage Warning Threshold&#34;</span>: <span style="color:#e6db74">&#34;85&#34;</span>,
    <span style="color:#e6db74">&#34;Swap Memory Usage Error Alarm&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Swap Memory Usage Error Threshold&#34;</span>: <span style="color:#e6db74">&#34;85&#34;</span>,
    <span style="color:#e6db74">&#34;Swap Memory Usage Warning Alarm&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Swap Memory Usage Warning Threshold&#34;</span>: <span style="color:#e6db74">&#34;60&#34;</span>,
    <span style="color:#e6db74">&#34;Paging Error Alarm Active&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Paging Error Alarm Threshold&#34;</span>: <span style="color:#e6db74">&#34;400&#34;</span>,
    <span style="color:#e6db74">&#34;Paging Warning Alarm Active&#34;</span>: <span style="color:#e6db74">&#34;FALSE&#34;</span>,
    <span style="color:#e6db74">&#34;Paging Warning Alarm Threshold&#34;</span>: <span style="color:#e6db74">&#34;150&#34;</span>
}

<span style="color:#75715e"># The agent&#39;s name we wish to configure.</span>
agentName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Cpu, Disk, and Memory Monitoring Agent&#39;</span>

client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
vsiService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Virtual_Guest&#39;</span>]
hardwareService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Hardware_Server&#39;</span>]
monitoringService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]

<span style="color:#75715e"># Getting the monitoring agents installed in the server or VSI.</span>
<span style="color:#66d9ef">try</span>:
    objectMask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mask[monitoringAgents[configurationValues[definition]]]&#39;</span>
    server <span style="color:#f92672">=</span> vsiService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
        server <span style="color:#f92672">=</span> hardwareService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span style="color:#f92672">+</span> ipAddres)
            exit(<span style="color:#ae81ff">1</span>)
<span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to get the server: faultCode=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, faultString=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
          <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
    exit(<span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Getting the agent to configure.</span>
agents <span style="color:#f92672">=</span> [agent <span style="color:#66d9ef">for</span> agent <span style="color:#f92672">in</span> server[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>] <span style="color:#66d9ef">if</span> agent[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> agentName]
<span style="color:#66d9ef">if</span> len(agents) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to find the agent: &#34;</span> <span style="color:#f92672">+</span> agentName)
    exit(<span style="color:#ae81ff">1</span>)
agent <span style="color:#f92672">=</span> agents[<span style="color:#ae81ff">0</span>]

<span style="color:#75715e"># Creating an SoftLayer_Monitoring_Agent_Configuration_Value skeleton</span>
<span style="color:#75715e"># which contains the configuration for the agent.</span>
configurationValues <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> configuration<span style="color:#f92672">.</span>keys():
    itemFound <span style="color:#f92672">=</span> False
    <span style="color:#66d9ef">for</span> value <span style="color:#f92672">in</span> agent[<span style="color:#e6db74">&#39;configurationValues&#39;</span>]:
        <span style="color:#66d9ef">if</span> value[<span style="color:#e6db74">&#39;definition&#39;</span>][<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> item<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper():
            itemFound <span style="color:#f92672">=</span> True
            configurationValue <span style="color:#f92672">=</span> value
            configurationValue[<span style="color:#e6db74">&#39;value&#39;</span>] <span style="color:#f92672">=</span> configuration[item]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper()
            configurationValues<span style="color:#f92672">.</span>append(configurationValue)
            <span style="color:#66d9ef">break</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> itemFound:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;The configuration: &#34;</span> <span style="color:#f92672">+</span> item <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is not available for the agent.&#34;</span>)


<span style="color:#75715e"># Calling the SoftLayer_Monitoring_Agent::applyConfigurationValues method</span>
<span style="color:#75715e"># to apply the changes in the agent.</span>
<span style="color:#75715e"># Note: In case there is no changes in the agent configuration the method</span>
<span style="color:#75715e"># will return error.</span>
<span style="color:#66d9ef">try</span>:
    result <span style="color:#f92672">=</span> monitoringService<span style="color:#f92672">.</span>applyConfigurationValues(configurationValues, id<span style="color:#f92672">=</span>agent[<span style="color:#e6db74">&#39;id&#39;</span>])
    <span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>dumps(result, sort_keys<span style="color:#f92672">=</span>True, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, separators<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;: &#39;</span>)))
<span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to apply the configuration in the monitoring agent: faultCode=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, faultString=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
          <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
    exit(<span style="color:#ae81ff">1</span>)

</code></pre></div><h3 id="edit-agent-profile">Edit Agent Profile</h3>
<p>Important manual pages</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/addConfigurationProfile">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/addConfigurationProfile</a></li>
<li><a href="http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value">http://sldn.softlayer.com/reference/datatypes/SoftLayer_Monitoring_Agent_Configuration_Value</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Edit the configuration for the &#34;Disk Profile&#34; section
</span><span style="color:#e6db74">of a monitoring agent.
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">import</span> SoftLayer
<span style="color:#f92672">import</span> json

<span style="color:#75715e"># The IP address of the server or VSI to configure.</span>
ipAddres <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;5.153.59.197&#34;</span>

configuration <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;Disk Path&#39;</span>: <span style="color:#e6db74">&#34;c:/&#34;</span>,
    <span style="color:#e6db74">&#39;Description&#39;</span>: <span style="color:#e6db74">&#34;file system c:/&#34;</span>,
    <span style="color:#e6db74">&#39;Graph Disk Usage&#39;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#39;Graph Disk Usage as Percentage&#39;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#39;Disk Usage Error Alarm&#39;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#39;Usage Error Alarm Threshold&#39;</span>: <span style="color:#e6db74">&#34;95&#34;</span>,
    <span style="color:#e6db74">&#39;Disk Usage Warning Alarm&#39;</span>: <span style="color:#e6db74">&#34;TRUE&#34;</span>,
    <span style="color:#e6db74">&#39;Disk Usage Warning Threshold&#39;</span>: <span style="color:#e6db74">&#34;90&#34;</span>,
}

<span style="color:#75715e"># The agent&#39;s name we will configure.</span>
agentName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Cpu, Disk, and Memory Monitoring Agent&#39;</span>

client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
vsiService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Virtual_Guest&#39;</span>]
hardwareService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Hardware_Server&#39;</span>]
monitoringService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]

<span style="color:#75715e"># Getting the monitoring agents installed in the server or VSI.</span>
<span style="color:#66d9ef">try</span>:
    objectMask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mask[monitoringAgents[configurationValues[definition]]]&#39;</span>
    server <span style="color:#f92672">=</span> vsiService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
        server <span style="color:#f92672">=</span> hardwareService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span style="color:#f92672">+</span> ipAddres)
            exit(<span style="color:#ae81ff">1</span>)
<span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to get the server: faultCode=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, faultString=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
          <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
    exit(<span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Getting the agent to configure.</span>
agents <span style="color:#f92672">=</span> [agent <span style="color:#66d9ef">for</span> agent <span style="color:#f92672">in</span> server[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>] <span style="color:#66d9ef">if</span> agent[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> agentName]
<span style="color:#66d9ef">if</span> len(agents) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to find the agent: &#34;</span> <span style="color:#f92672">+</span> agentName)
    exit(<span style="color:#ae81ff">1</span>)
agent <span style="color:#f92672">=</span> agents[<span style="color:#ae81ff">0</span>]

<span style="color:#75715e"># Getting the profile id to edit.</span>
<span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;Disk Path&#39;</span> <span style="color:#f92672">in</span> configuration:
    profileId <span style="color:#f92672">=</span> [value[<span style="color:#e6db74">&#39;profileId&#39;</span>] <span style="color:#66d9ef">for</span> value <span style="color:#f92672">in</span> agent[<span style="color:#e6db74">&#39;configurationValues&#39;</span>]
                 <span style="color:#66d9ef">if</span> value[<span style="color:#e6db74">&#39;definition&#39;</span>][<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;Disk Path&#39;</span> <span style="color:#f92672">and</span>
                 value[<span style="color:#e6db74">&#39;value&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> configuration[<span style="color:#e6db74">&#39;Disk Path&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper()]
    profileId <span style="color:#f92672">=</span> profileId[<span style="color:#ae81ff">0</span>]
<span style="color:#66d9ef">else</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;It is required an Disk Path value in the configuration.&#34;</span>)
    exit(<span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Creating an SoftLayer_Monitoring_Agent_Configuration_Value skeleton</span>
<span style="color:#75715e"># which contains the configuration for the agent.</span>
configurationValues <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> configuration<span style="color:#f92672">.</span>keys():
    itemFound <span style="color:#f92672">=</span> False
    <span style="color:#66d9ef">for</span> value <span style="color:#f92672">in</span> agent[<span style="color:#e6db74">&#39;configurationValues&#39;</span>]:
        <span style="color:#66d9ef">if</span> value[<span style="color:#e6db74">&#39;definition&#39;</span>][<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> item<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">and</span> value[<span style="color:#e6db74">&#39;profileId&#39;</span>] <span style="color:#f92672">==</span> profileId:
            itemFound <span style="color:#f92672">=</span> True
            configurationValue <span style="color:#f92672">=</span> value
            configurationValue[<span style="color:#e6db74">&#39;value&#39;</span>] <span style="color:#f92672">=</span> configuration[item]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper()
            configurationValues<span style="color:#f92672">.</span>append(configurationValue)
            <span style="color:#66d9ef">break</span>
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> itemFound:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;The configuration: &#34;</span> <span style="color:#f92672">+</span> item <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is not available for the agent.&#34;</span>)

<span style="color:#75715e"># Calling the SoftLayer_Monitoring_Agent::applyConfigurationValues method</span>
<span style="color:#75715e"># to apply the changes in the agent.</span>
<span style="color:#75715e"># Note: In case there is no changes in the agent configuration the method</span>
<span style="color:#75715e"># will return error.</span>
<span style="color:#66d9ef">try</span>:
    result <span style="color:#f92672">=</span> monitoringService<span style="color:#f92672">.</span>addConfigurationProfile(configurationValues, id<span style="color:#f92672">=</span>agent[<span style="color:#e6db74">&#39;id&#39;</span>])
    <span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>dumps(result, sort_keys<span style="color:#f92672">=</span>True, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, separators<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;: &#39;</span>)))
<span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to apply the configuration in the monitoring agent: faultCode=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, faultString=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>
          <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
    exit(<span style="color:#ae81ff">1</span>)

</code></pre></div><h3 id="deactive-agent">Deactive Agent</h3>
<p>Important manual pages:</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/deactivate">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/deactivate</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Desactive an agent.
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">import</span> SoftLayer
<span style="color:#f92672">import</span> json

vsiIp <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;169.45.98.148&#34;</span>
agentName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DHCP Response Monitoring Agent&#34;</span>

client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client(
vsiService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Virtual_Guest&#39;</span>]
agentService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]


objectMask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;mask[monitoringRobot[id, robotStatus[name]], monitoringAgents[statusName, name, id], monitoringServiceEligibilityFlag, datacenter]&#34;&#34;&#34;</span>
vsi <span style="color:#f92672">=</span> vsiService<span style="color:#f92672">.</span>findByIpAddress(vsiIp, mask<span style="color:#f92672">=</span>objectMask)
<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> vsi:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;There is no a vsi with the IP address: &#34;</span> <span style="color:#f92672">+</span> vsiIp)
    exiΩt(<span style="color:#ae81ff">1</span>)
agent <span style="color:#f92672">=</span> {}
<span style="color:#66d9ef">for</span> agents <span style="color:#f92672">in</span> vsi[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>]:
    <span style="color:#66d9ef">if</span> agents[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> agentName<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper():
        agent <span style="color:#f92672">=</span> agents
        <span style="color:#66d9ef">break</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> agent:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;The VSI does not have a monitor agent with the name: &#34;</span> <span style="color:#f92672">+</span>  agentName)
    exit(<span style="color:#ae81ff">1</span>)
result <span style="color:#f92672">=</span> agentService<span style="color:#f92672">.</span>deactivate(id<span style="color:#f92672">=</span>agent[<span style="color:#e6db74">&#39;id&#39;</span>])
<span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>dumps(result, sort_keys<span style="color:#f92672">=</span>True, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, separators<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;: &#39;</span>)))

</code></pre></div><h3 id="get-agent-configuration">Get Agent Configuration</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Get the configuration of the monitoring agent in a server or VSI.
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">import</span> SoftLayer
<span style="color:#f92672">import</span> json

ipAddres <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;5.153.59.197&#34;</span>
client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
vsiService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Virtual_Guest&#39;</span>]
hardwareService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Hardware_Server&#39;</span>]

<span style="color:#66d9ef">try</span>:
    objectMask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mask[monitoringAgents[configurationTemplate[configurationSections[subSections]],&#39;</span> \
                 <span style="color:#e6db74">&#39;configurationValues[id, value, profileId, agentId, configurationDefinitionId,&#39;</span> \
                 <span style="color:#e6db74">&#39;profile, definition[attributes, section, valueType]]]]&#39;</span>
    server <span style="color:#f92672">=</span> vsiService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
        server <span style="color:#f92672">=</span> hardwareService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span style="color:#f92672">+</span> ipAddres)
            exit(<span style="color:#ae81ff">1</span>)
<span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to get the server: faultCode=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">, faultString=</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#34;</span>        
          <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
    exit(<span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># We will get the configuration of the active agents</span>
agents <span style="color:#f92672">=</span> [agent <span style="color:#66d9ef">for</span> agent <span style="color:#f92672">in</span> server[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>] <span style="color:#66d9ef">if</span> agent[<span style="color:#e6db74">&#39;statusName&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;Active&#34;</span>]
server[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>] <span style="color:#f92672">=</span> agents

configs <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> agent <span style="color:#f92672">in</span> server[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>]:
    config <span style="color:#f92672">=</span> {}
    config[<span style="color:#e6db74">&#39;agent&#39;</span>] <span style="color:#f92672">=</span> agent[<span style="color:#e6db74">&#39;name&#39;</span>]
    config[<span style="color:#e6db74">&#39;id&#39;</span>] <span style="color:#f92672">=</span> agent[<span style="color:#e6db74">&#39;id&#39;</span>]
    sections <span style="color:#f92672">=</span> []
    <span style="color:#66d9ef">for</span> section <span style="color:#f92672">in</span> agent[<span style="color:#e6db74">&#39;configurationTemplate&#39;</span>][<span style="color:#e6db74">&#39;configurationSections&#39;</span>]:
        sect <span style="color:#f92672">=</span> {}
        subsects <span style="color:#f92672">=</span> []
        hasProfile <span style="color:#f92672">=</span> False
        profileIds <span style="color:#f92672">=</span> []
        confs <span style="color:#f92672">=</span> []
        <span style="color:#66d9ef">for</span> subsection <span style="color:#f92672">in</span> section[<span style="color:#e6db74">&#39;subSections&#39;</span>]:
            values <span style="color:#f92672">=</span> [value <span style="color:#66d9ef">for</span> value <span style="color:#f92672">in</span> agent[<span style="color:#e6db74">&#39;configurationValues&#39;</span>] <span style="color:#66d9ef">if</span>
                      value[<span style="color:#e6db74">&#39;definition&#39;</span>][<span style="color:#e6db74">&#39;sectionId&#39;</span>] <span style="color:#f92672">==</span> subsection[<span style="color:#e6db74">&#39;id&#39;</span>]]
            <span style="color:#66d9ef">for</span> value <span style="color:#f92672">in</span> values:
                conf <span style="color:#f92672">=</span> {}
                <span style="color:#66d9ef">if</span> value[<span style="color:#e6db74">&#39;profileId&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span>:
                    conf[value[<span style="color:#e6db74">&#39;definition&#39;</span>][<span style="color:#e6db74">&#39;name&#39;</span>]] <span style="color:#f92672">=</span> value[<span style="color:#e6db74">&#39;value&#39;</span>]
                    confs<span style="color:#f92672">.</span>append(conf)
                <span style="color:#66d9ef">else</span>:
                    hasProfile <span style="color:#f92672">=</span> True
                    profileIds<span style="color:#f92672">.</span>append(value[<span style="color:#e6db74">&#39;profileId&#39;</span>])      
        sect[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">=</span> section[<span style="color:#e6db74">&#39;name&#39;</span>]
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> hasProfile:
            sect[<span style="color:#e6db74">&#39;configuration&#39;</span>] <span style="color:#f92672">=</span> confs
            sections<span style="color:#f92672">.</span>append(sect)
        <span style="color:#66d9ef">else</span>:
            profileIds <span style="color:#f92672">=</span> list(set(profileIds))
            profiles <span style="color:#f92672">=</span> []
            <span style="color:#66d9ef">for</span> profileId <span style="color:#f92672">in</span> profileIds:
                profile <span style="color:#f92672">=</span> {}
                valueConfs <span style="color:#f92672">=</span> []
                valueProfiles <span style="color:#f92672">=</span> [value <span style="color:#66d9ef">for</span> value <span style="color:#f92672">in</span> agent[<span style="color:#e6db74">&#39;configurationValues&#39;</span>] <span style="color:#66d9ef">if</span>
                                 value[<span style="color:#e6db74">&#39;profileId&#39;</span>] <span style="color:#f92672">==</span> profileId]
                profile[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">=</span> valueProfiles[<span style="color:#ae81ff">0</span>][<span style="color:#e6db74">&#39;profile&#39;</span>][<span style="color:#e6db74">&#39;name&#39;</span>]
                <span style="color:#66d9ef">for</span> valueProfile <span style="color:#f92672">in</span> valueProfiles:
                    value <span style="color:#f92672">=</span> {}
                    value[valueProfile[<span style="color:#e6db74">&#39;definition&#39;</span>][<span style="color:#e6db74">&#39;name&#39;</span>]] <span style="color:#f92672">=</span> valueProfile[<span style="color:#e6db74">&#39;value&#39;</span>]
                    valueConfs<span style="color:#f92672">.</span>append(value)
                profile[<span style="color:#e6db74">&#39;configuration&#39;</span>] <span style="color:#f92672">=</span> valueConfs
                profiles<span style="color:#f92672">.</span>append(profile)
            sect[<span style="color:#e6db74">&#39;profiles&#39;</span>] <span style="color:#f92672">=</span> profiles
            sections<span style="color:#f92672">.</span>append(sect)
    config[<span style="color:#e6db74">&#39;sections&#39;</span>] <span style="color:#f92672">=</span> sections
    configs<span style="color:#f92672">.</span>append(config)
<span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>dumps(configs, sort_keys<span style="color:#f92672">=</span>True, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, separators<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;: &#39;</span>)))

</code></pre></div><h3 id="get-monitoring-graph-data">Get monitoring graph data</h3>
<p>The script gets the CPU usage in a selected date range.</p>
<p>Important manual pages.</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getGraphData">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getGraphData</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Get the graph data from a monitoring agent
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#f92672">import</span> SoftLayer

<span style="color:#75715e"># This data can take a little while to obtain for long date ranges</span>
TIMEOUT <span style="color:#f92672">=</span> <span style="color:#ae81ff">12000</span>

<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Creating an skeleton SoftLayer_Container_Metric_Data_Type object
</span><span style="color:#e6db74">which represent the metric data that we will get.
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
metricDataTypes <span style="color:#f92672">=</span> [
    {
        <span style="color:#e6db74">&#34;summaryType&#34;</span>: <span style="color:#e6db74">&#34;average&#34;</span>,
        <span style="color:#e6db74">&#34;keyName&#34;</span>: <span style="color:#e6db74">&#34;CDM_CPU_USAGE&#34;</span>,
        <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;cdm_cpu_usage_U3lzdGVt&#34;</span>
    }
]

<span style="color:#75715e"># The start date for the graph data</span>
starDate <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2014-09-29T01:48:08.474Z&#34;</span>
<span style="color:#75715e"># The end date for the graph data</span>
endDate <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;2014-09-29T01:53:08.474Z&#34;</span>
<span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">The agent ID from where we want to get the graph data
</span><span style="color:#e6db74">to get the monitor agents in your virtual guest
</span><span style="color:#e6db74">call the SoftLayer_Virtual_Guest::getMonitoringAgents method
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
agentId <span style="color:#f92672">=</span> <span style="color:#ae81ff">1448912</span>

client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client(timeout<span style="color:#f92672">=</span>TIMEOUT)
monitorAgentService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]
<span style="color:#75715e"># calling the Softlayer_Monitoring_Agent::getGraphData method</span>
result <span style="color:#f92672">=</span> monitorAgentService<span style="color:#f92672">.</span>getGraphData(
    metricDataTypes, starDate, endDate, id<span style="color:#f92672">=</span>agentId)
<span style="color:#66d9ef">print</span>(result)
</code></pre></div><h3 id="view-agent-report">View Agent Report</h3>
<p>Important manual pages</p>
<ul>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Virtual_Guest/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress">http://sldn.softlayer.com/reference/services/SoftLayer_Hardware_Server/findByIpAddress</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getGraphData">http://sldn.softlayer.com/reference/services/SoftLayer_Monitoring_Agent/getGraphData</a></li>
<li><a href="http://sldn.softlayer.com/reference/services/Monitoring_Agent_Configuration_Value/getMetricDataType">http://sldn.softlayer.com/reference/services/Monitoring_Agent_Configuration_Value/getMetricDataType</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">View the reports for the  &#34;CPU&#34; section from the
</span><span style="color:#e6db74">&#39;Cpu, Disk, and Memory Monitoring Agent&#39; monitor agent.
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#f92672">import</span> SoftLayer
<span style="color:#f92672">import</span> json

<span style="color:#75715e"># The IP address of the server or VSI to configure.</span>
ipAddres <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;5.153.59.197&#34;</span>

startDate <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2016-01-02&#39;</span>
endDate <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;2016-01-08&#39;</span>

<span style="color:#75715e"># Set &#34;True&#34; the reports you wish to see.</span>
reports <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;Graph System CPU Usage&#39;</span>: <span style="color:#e6db74">&#34;False&#34;</span>,
    <span style="color:#e6db74">&#39;Graph Total CPU Usage&#39;</span>: <span style="color:#e6db74">&#34;False&#34;</span>,
    <span style="color:#e6db74">&#39;Graph User CPU Usage&#39;</span>: <span style="color:#e6db74">&#34;False&#34;</span>,
    <span style="color:#e6db74">&#39;Graph I/O Wait CPU Usage&#39;</span>: <span style="color:#e6db74">&#34;True&#34;</span>,
}

<span style="color:#75715e"># The agent&#39;s name we wish to see the reports.</span>
agentName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Cpu, Disk, and Memory Monitoring Agent&#39;</span>

client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
vsiService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Virtual_Guest&#39;</span>]
hardwareService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Hardware_Server&#39;</span>]
monitoringService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]
agentConfigurationService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;Monitoring_Agent_Configuration_Value&#39;</span>]

<span style="color:#75715e"># Getting the monitoring agents installed in the server or VSI.</span>

<span style="color:#75715e"># Setting an object mask to retrieve information about the monitoring agents.</span>
objectMask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mask[monitoringAgents[configurationValues[definition]]]&#39;</span>
server <span style="color:#f92672">=</span> vsiService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
    server <span style="color:#f92672">=</span> hardwareService<span style="color:#f92672">.</span>findByIpAddress(ipAddres, mask<span style="color:#f92672">=</span>objectMask)
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> server:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;There is no a Server or VSI with the IP address: &#34;</span> <span style="color:#f92672">+</span> ipAddres)
        exit(<span style="color:#ae81ff">1</span>)

<span style="color:#75715e"># Getting the agent to see the reports.</span>
agents <span style="color:#f92672">=</span> [agent <span style="color:#66d9ef">for</span> agent <span style="color:#f92672">in</span> server[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>] <span style="color:#66d9ef">if</span> agent[<span style="color:#e6db74">&#39;name&#39;</span>] <span style="color:#f92672">==</span> agentName]
<span style="color:#66d9ef">if</span> len(agents) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to find the agent: &#34;</span> <span style="color:#f92672">+</span> agentName)
    exit(<span style="color:#ae81ff">1</span>)
agent <span style="color:#f92672">=</span> agents[<span style="color:#ae81ff">0</span>]

<span style="color:#75715e"># Creating the list of SoftLayer_Container_Metric_Data_Type objects</span>
metricDataTypes <span style="color:#f92672">=</span> []
<span style="color:#66d9ef">for</span> item <span style="color:#f92672">in</span> reports<span style="color:#f92672">.</span>keys():
    <span style="color:#66d9ef">if</span> reports[item]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;TRUE&#34;</span>:
        itemFound <span style="color:#f92672">=</span> False
        <span style="color:#66d9ef">for</span> value <span style="color:#f92672">in</span> agent[<span style="color:#e6db74">&#39;configurationValues&#39;</span>]:
            <span style="color:#66d9ef">if</span> value[<span style="color:#e6db74">&#39;definition&#39;</span>][<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> item<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper():
                itemFound <span style="color:#f92672">=</span> True
                <span style="color:#66d9ef">if</span> value[<span style="color:#e6db74">&#39;value&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;TRUE&#34;</span>:
                    <span style="color:#66d9ef">try</span>:
                        metrics <span style="color:#f92672">=</span> agentConfigurationService<span style="color:#f92672">.</span>getMetricDataType(id<span style="color:#f92672">=</span>value[<span style="color:#e6db74">&#39;id&#39;</span>])
                        metricDataTypes<span style="color:#f92672">.</span>append(metrics)
                    <span style="color:#66d9ef">except</span> SoftLayer<span style="color:#f92672">.</span>SoftLayerAPIError <span style="color:#66d9ef">as</span> e:
                        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Unable to get the metrics. &#34;</span> <span style="color:#f92672">%</span> (e<span style="color:#f92672">.</span>faultCode, e<span style="color:#f92672">.</span>faultString))
                <span style="color:#66d9ef">else</span>:
                    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;The report: &#34;</span> <span style="color:#f92672">+</span> item <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is disable for the agent. Please review the agent configuration.&#34;</span>)
                    exit(<span style="color:#ae81ff">1</span>)
                <span style="color:#66d9ef">break</span>
        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> itemFound:
            <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;The configuration: &#34;</span> <span style="color:#f92672">+</span> item <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34; is not available for the agent.&#34;</span>)

<span style="color:#75715e"># Getting the reports.</span>
data <span style="color:#f92672">=</span> monitoringService<span style="color:#f92672">.</span>getGraphData(metricDataTypes, startDate, endDate, id<span style="color:#f92672">=</span>agent[<span style="color:#e6db74">&#39;id&#39;</span>])
<span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>dumps(data, sort_keys<span style="color:#f92672">=</span>True, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, separators<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;: &#39;</span>)))
</code></pre></div><h3 id="create-ping-monitor">Create Ping Monitor</h3>
<p>The script creates a Network Notification of type  service ping
and a notify wait of 5 minutes.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Create Network Notification
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>
<span style="color:#f92672">import</span> SoftLayer
<span style="color:#75715e"># Declare the API client</span>
client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
networkMonitorService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Network_Monitor_Version1_Query_Host&#39;</span>]

objectTemplate <span style="color:#f92672">=</span> [
    {
        <span style="color:#e6db74">&#34;guestId&#34;</span>: <span style="color:#ae81ff">6143038</span>,
        <span style="color:#e6db74">&#34;ipAddress&#34;</span>: <span style="color:#e6db74">&#34;10.104.50.118&#34;</span>,
        <span style="color:#e6db74">&#34;queryTypeId&#34;</span>: <span style="color:#ae81ff">1</span>,
        <span style="color:#e6db74">&#34;responseActionId&#34;</span>: <span style="color:#ae81ff">2</span>,
        <span style="color:#e6db74">&#34;waitCycles&#34;</span>: <span style="color:#ae81ff">1</span>
    }
]
result <span style="color:#f92672">=</span> networkMonitorService<span style="color:#f92672">.</span>createObjects(objectTemplate)
<span style="color:#66d9ef">print</span>(result)
</code></pre></div><h3 id="redeploy-or-restart-agent">Redeploy or Restart Agent</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">Re-deploy an agent.
</span><span style="color:#e6db74">&#34;&#34;&#34;</span>

<span style="color:#f92672">import</span> SoftLayer
<span style="color:#f92672">import</span> json

vsiIp <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;169.45.98.148&#34;</span>
agentName <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;DHCP Response Monitoring Agent&#34;</span>
client <span style="color:#f92672">=</span> SoftLayer<span style="color:#f92672">.</span>Client()
vsiService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Virtual_Guest&#39;</span>]
agentService <span style="color:#f92672">=</span> client[<span style="color:#e6db74">&#39;SoftLayer_Monitoring_Agent&#39;</span>]


objectMask <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mask[monitoringRobot[id, robotStatus[name]], monitoringAgents[statusName, name, id], monitoringServiceEligibilityFlag, datacenter]&#34;</span>
vsi <span style="color:#f92672">=</span> vsiService<span style="color:#f92672">.</span>findByIpAddress(vsiIp, mask<span style="color:#f92672">=</span>objectMask)
<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> vsi:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;There is no a vsi with the IP address: &#34;</span> <span style="color:#f92672">+</span> vsiIp)
    exit(<span style="color:#ae81ff">1</span>)
agent <span style="color:#f92672">=</span> {}
<span style="color:#66d9ef">for</span> agents <span style="color:#f92672">in</span> vsi[<span style="color:#e6db74">&#39;monitoringAgents&#39;</span>]:
    <span style="color:#66d9ef">if</span> agents[<span style="color:#e6db74">&#39;name&#39;</span>]<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper() <span style="color:#f92672">==</span> agentName<span style="color:#f92672">.</span>strip()<span style="color:#f92672">.</span>upper():
        agent <span style="color:#f92672">=</span> agents
        <span style="color:#66d9ef">break</span>
<span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> <span style="color:#e6db74">&#39;id&#39;</span> <span style="color:#f92672">in</span> agent:
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;The VSI does not have a monitor agent with the name: &#34;</span> <span style="color:#f92672">+</span>  agentName)
    exit(<span style="color:#ae81ff">1</span>)
configuration <span style="color:#f92672">=</span> agentService<span style="color:#f92672">.</span>getConfigurationTemplate(id<span style="color:#f92672">=</span>agent[<span style="color:#e6db74">&#39;id&#39;</span>])
result <span style="color:#f92672">=</span> agentService<span style="color:#f92672">.</span>deployMonitoringAgent(configuration[<span style="color:#e6db74">&#39;id&#39;</span>], id<span style="color:#f92672">=</span>agent[<span style="color:#e6db74">&#39;id&#39;</span>])
<span style="color:#75715e"># Restarts the Agent instead</span>
<span style="color:#75715e"># result = agentService.restartMonitoringAgent(id=agent[&#39;id&#39;])</span>
<span style="color:#66d9ef">print</span>(json<span style="color:#f92672">.</span>dumps(result, sort_keys<span style="color:#f92672">=</span>True, indent<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, separators<span style="color:#f92672">=</span>(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;: &#39;</span>)))
</code></pre></div>
            </div>
        </div>

    </div>
    <hr>
    <div class="row">
            
        <div class="col-md-6">
            
<div class="panel panel-default">
    <div class="panel-heading" style="padding: 2px 15px;">
        <h4>More Documentation</h4>
    </div>
    <div class="panel-body">
        <a href="https://softlayer.github.com/reference/softlayerapi"><i class="fa fa-link"></i> SoftLayer API Reference<br></a>
        <a href="https://github.com/softlayer/softlayer-java"><i class="fab fa-github"></i> softlayer-java<br></a>
        <a href="https://github.com/softlayer/softlayer-api-perl-client"><i class="fab fa-github"></i> softlayer-perl<br></a>
        <a href="https://github.com/softlayer/softlayer-api-php-client"><i class="fab fa-github"></i> softlayer-php<br></a>
        <a href="https://github.com/softlayer/softlayer-python"><i class="fab fa-github"></i> softlayer-python<br></a>
        <a href="https://github.com/softlayer/softlayer-ruby"><i class="fab fa-github"></i> softlayer-ruby<br></a>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading text-center" style="padding: 2px 15px;">
      <a href="https://www.facebook.com/IBMBluemixIaaS/"><i class="fab fa-facebook-square" alt="facebook"></i> </a>
      <a href="https://twitter.com/IBMBluemixIaaS"><i class="fab fa-twitter" alt="twitter"></i> </a>
      <a href="http://www.linkedin.com/company/softlayer-technologies-inc-" alt="linked-in"><i class="fab fa-linkedin"></i> </a>
      <a href="https://github.com/softlayer/softlayer.github.io"><i class="fab fa-github" alt="github"></i> </a>

    </div>
</div>

        </div>
        <div class="col-md-6">
            <div class="well well-sm" style="word-wrap: break-word;"> 
                <strong>Feedback? <span class="fa fa-comment"/></strong>
                    <p>
                        We would love to hear it<br>
                        <a class="" href="https://github.com/softlayer/api_examples/issues/new?title=Feedback%20for%20python%20-%20Monitoring%20Agent%20Management&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2fpython%2fsoftlayer_monitoring%2f"><span class="fa fa-github-square"/> Open an issue</a>
                    </p>
            </div>
        </div>

    </div>
        <footer>
            <div class="row">
                <hr>
                <div class="col-sm-12">
                    <p>&copy; SoftLayer 2015<br>
                    Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
                </div>
            </div>
        </footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>
