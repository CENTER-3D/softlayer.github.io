<!doctype html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SoftLayer API Examples, implementations, and release notes.">
    <meta name="author" content="SoftLayer">

    <title>Authenticating to the SoftLayer API - https://sldn.softlayer.com/</title>
    <link rel="canonical" href="https://sldn.softlayer.com/article/authenticating-softlayer-api/">
        <link href="https://sldn.softlayer.com/css/main.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/bootstrap.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/custom.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/monokai.css" rel="stylesheet">
    <link href="https://sldn.softlayer.com/css/highlight/solarized_dark.css" rel="stylesheet">

    <script src="https://sldn.softlayer.com/js/highlight.pack.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
    <link rel="shortcut icon" href="https://sldn.softlayer.com/img/favicon.ico" type="image/x-icon" />
	<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Lato" />
            

    <script src="https://sldn.softlayer.com/js/jquery-3.3.1.min.js"></script> 
    <script src="https://sldn.softlayer.com/js/sldn.js"></script>


    <link href="https://sldn.softlayer.com/fontawesome/css/fontawesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/brands.min.css" rel="stylesheet" type="text/css">
    <link href="https://sldn.softlayer.com/fontawesome/css/solid.min.css" rel="stylesheet" type="text/css">
    
    <script defer src="https://sldn.softlayer.com/fontawesome/js/solid.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/brands.min.js"></script>
    <script defer src="https://sldn.softlayer.com/fontawesome/js/fontawesome.min.js"></script>

    <script>
		$(document).ready(function() {
			$('table').addClass("table table-hover table-striped")
		})
	</script>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-88235803-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="https://sldn.softlayer.com/">SoftLayer API</a>
            </div>
            <div class="collapse navbar-collapse navbar-ex1-collapse">
                <ul class="nav navbar-nav">
                    
                        <li><a href="https://sldn.softlayer.com/article/">Articles</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/reference/softlayerapi">Documentation</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/go/">Go</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/java/">Java</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/perl/">Perl</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/php/">PHP</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/python/">Python</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/rest/">Rest</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/ruby/">Ruby</a></li>
                    
                        <li><a href="https://sldn.softlayer.com/tools/">Tools</a></li>
                    

                    
                </ul>
                <div id="custom-search-input" class="pull-right">
                  <form class="navbar-form" role="search" method="get" action="https://www.bing.com/search">
                    <div class="input-group col-md-12">
                      <input type="text" class="form-control input-md" placeholder="Search" name="q" id="srch-term">
                      <input type="hidden" name="q1" value="site:sldn.softlayer.com" />
                      <div class="input-group-btn">
                        <button class="btn btn-info" type="submit">
                          <i class="glyphicon glyphicon-search"></i>
                        </button>
                      </div>
                    </div>
                  </form>
                </div>
            </div>
        </div>
    </nav>

<div class="container">
    <div class="row">
    
        <div class="col-md-3">
            <div style="word-wrap: break-word;"> 
                <h4>June 20, 2011<br></h4>
            </div>
        </div>
        <div class="col-md-9">
                <strong>Tags <span class="fa fa-tags"/></strong>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/article">article</a>
                
                    <a class="label label-danger" href="https://sldn.softlayer.com/tags/sldn">sldn</a>
                          
        </div>
    </div>
    <hr>
    <div class="row">
        <div class="col-md-12">
            <div class="well well-sm article" style="word-wrap: break-word;">
                <div class="article-title">
                    <h1>Authenticating to the SoftLayer API</h1>
                    <small>Authenticating to the SoftLayer API</small>
                </div>
                
                
                
                <h3 id="note-about-ibmid">Note about IBMid</h3>
<p>More information about how IBMid works can be found here:</p>
<ul>
<li><a href="https://console.bluemix.net/docs/account/softlayerlink.html#unifyingaccounts">https://console.bluemix.net/docs/account/softlayerlink.html#unifyingaccounts</a></li>
<li><a href="https://console.bluemix.net/docs/customer-portal/cpmanibmid.html#customerportal_ibmid">https://console.bluemix.net/docs/customer-portal/cpmanibmid.html#customerportal_ibmid</a></li>
<li><a href="https://console.bluemix.net/docs/iam/apikeys.html#manapikey">https://console.bluemix.net/docs/iam/apikeys.html#manapikey</a></li>
</ul>
<p>Currently when an IBMid is linked to SoftLayer, a user record is created in the SoftLayer environment, with a username that matches the email used to login. While you won&rsquo;t be able to login to the SoftLayer control portal directly with your password(instead you will need to authenticate with the IBMid service), you can still follow these steps to create an API key for your SoftLayer Infrastructure</p>
<h3 id="softlayer-users">SoftLayer Users</h3>
<p>&lsquo;&lsquo;username&rsquo;&rsquo; which contains your portal/API username, and &lsquo;&lsquo;apiKey&rsquo;&rsquo; which contains your API access key. If you don&rsquo;t provide the authenticate header the API returns the [[exception]] &ldquo;No valid authentication headers found.&rdquo;, and if you provide an invalid username and apiKey combination the API returns the exception &ldquo;Invalid API Token&rdquo;.</p>
<h3 id="soap">SOAP</h3>
<p>A SOAP representation of the <code>authenticate</code> header looks like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="nt">&lt;SOAP-ENV:Envelope</span> <span class="na">xmlns:SOAP-ENV=</span><span class="s">&#34;http://schemas.xmlsoap.org/soap/envelope/&#34;</span> <span class="na">xmlns:ns1=</span><span class="s">&#34;http://api.service.softlayer.com/soap/v3.1/&#34;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;SOAP-ENV:Header&gt;</span>
    <span class="nt">&lt;ns1:authenticate&gt;</span>
      <span class="nt">&lt;username&gt;</span>USERNAME<span class="nt">&lt;/username&gt;</span>
      <span class="nt">&lt;apiKey&gt;</span>APIKEY<span class="nt">&lt;/apiKey&gt;</span>
    <span class="nt">&lt;/ns1:authenticate&gt;</span>
  <span class="nt">&lt;/SOAP-ENV:Header&gt;</span>
  <span class="nt">&lt;SOAP-ENV:Body&gt;</span>
    <span class="nt">&lt;ns1:getObject&gt;&lt;/ns1:getObject&gt;</span>
  <span class="nt">&lt;/SOAP-ENV:Body&gt;</span>
<span class="nt">&lt;/SOAP-ENV:Envelope&gt;</span>
</code></pre></div><h3 id="xmlrpc">XMLRPC</h3>
<p>while it&rsquo;s XML-RPC counterpart looks like this:</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="nt">&lt;xml&gt;</span>
<span class="nt">&lt;struct&gt;</span>
    <span class="nt">&lt;member&gt;</span>
        <span class="nt">&lt;name&gt;</span>authenticate<span class="nt">&lt;/name&gt;</span>
        <span class="nt">&lt;value&gt;</span>
            <span class="nt">&lt;struct&gt;</span>
                <span class="nt">&lt;member&gt;</span>
                    <span class="nt">&lt;name&gt;</span>username<span class="nt">&lt;/name&gt;</span>
                    <span class="nt">&lt;value&gt;</span>
                        <span class="nt">&lt;string&gt;</span>MY_USERNAME<span class="nt">&lt;/string&gt;</span>
                    <span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;/member&gt;</span>
                <span class="nt">&lt;member&gt;</span>
                    <span class="nt">&lt;name&gt;</span>apiKey<span class="nt">&lt;/name&gt;</span>
                    <span class="nt">&lt;value&gt;</span>
                        <span class="nt">&lt;string&gt;</span>MY_API_ACCESS_KEY<span class="nt">&lt;/string&gt;</span>
                    <span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;/member&gt;</span>
            <span class="nt">&lt;/struct&gt;</span>
        <span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/member&gt;</span>
<span class="nt">&lt;/struct&gt;</span>
<span class="nt">&lt;/xml&gt;</span>
</code></pre></div><h3 id="rest">REST</h3>
<p>With REST, you can simply use the HTTP Basic Authentication
<code>curl  -vvv -u $SL_USER:$SL_APIKEY 'https://api.softlayer.com/rest/v3.1/SoftLayer_Account/getObject'</code></p>
<h2 id="generating-your-softlayer-api-key">Generating Your SoftLayer API Key</h2>
<p>There are two ways to generate an API access key, via the portal or by direct API calls. To generate your own API access key in the customer portal see this article: <a href="https://cloud.ibm.com/docs/iam?topic=iam-classic_keys&amp;locale=dk">Managing classic infrastructure API keys</a></p>
<p>To generate an API access key via API calls invoke the <a href="https://softlayer.github.io/reference/services/SoftLayer_User_Customer/addApiAuthenticationKey">SoftLayer_User_Customer::addApiAuthenticationKey</a> method in the SoftLayer_User_Customer service. To remove a user&rsquo;s API access key execute the <a href="https://softlayer.github.io/reference/services/SoftLayer_User_Customer/removeApiAuthenticationKey">SoftLayer_User_Customer::removeApiAuthenticationKey</a> method in the same service. Be careful when removing API access keys. Removing these keys will remove that user&rsquo;s ability to use the SoftLayer API.</p>
<p><a href="https://sldn.softlayer.com/python/manageUsers/">Example</a></p>
<h3 id="cloudibmcom-api-key">cloud.ibm.com API key</h3>
<blockquote>
<p><em>NOTE</em> when using a cloud.ibm.com key, your username when authenticating with the SL API will be LITTERALLY &lsquo;apikey&rsquo;, not your actual username.</p>
</blockquote>
<ul>
<li><a href="https://cloud.ibm.com/docs/iam?topic=iam-manapikey#manapikey">Understanding API keys</a></li>
<li><a href="https://cloud.ibm.com/docs/iam?topic=iam-userapikey#userapikey">Managing user API keys</a></li>
</ul>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$&gt; ibmcloud iam api-key-create  TEST-cgallo01 -d <span class="s2">&#34;A test api key&#34;</span>
Creating API key TEST-cgallo01 as cgallo@us.ibm.com...
OK
API key TEST-cgallo01 was created

Please preserve the API key! It cannot be retrieved after its created.

Name          TEST-cgallo01
Description   A <span class="nb">test</span> api key
Created At    2020-02-07T22:05+0000
API Key       aAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaA
Locked        <span class="nb">false</span>
UUID          ApiKey-1c505b6d-9e81-4b87-b929-f9493c2dea63

$&gt; <span class="nv">SL_USER</span><span class="o">=</span>apikey
$&gt; <span class="nv">SL_APIKEY</span><span class="o">=</span>aAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaAaA
$&gt;  curl -g -u <span class="nv">$SL_USER</span>:<span class="nv">$SL_APIKEY</span>  <span class="s1">&#39;https://api.softlayer.com/rest/v3.1/SoftLayer_Account/getObject.json?objectMask=mask[id]&#39;</span>
<span class="o">{</span><span class="s2">&#34;id&#34;</span>:123456<span class="o">}</span>
</code></pre></div><h2 id="temporary-api-key">Temporary API Key</h2>
<p>It is possible to get a short lived API key using a username/password combination with <a href="https://sldn.softlayer.com/reference/services/SoftLayer_User_Customer/getPortalLoginToken/">SoftLayer_User_Customer::getPortalLoginToken</a>. This token can be used in place of an API key during calls and will expire after 48 hours.</p>
<p><em>NOTICE</em> SoftLayer_User_Customer::getPortalLoginToken does not support the REST endpoint. You will need to send in your request with an XML or SOAP call.</p>
<p><em>NOTICE</em> This method also doesn&rsquo;t work with IBMid username/passwords</p>
<h2 id="temporary-ibmid-token">Temporary IBMid Token</h2>
<p>It is possible to use the IBMid authentication service to make softlayer API calls. See <a href="https://cloud.ibm.com/apidocs/iam-identity-token-api">IAM Token API</a> for more specific details.</p>
<h3 id="get-the-ims_token">Get the IMS_TOKEN</h3>
<p>For most users, you will need your username and password, send that to <a href="https://iam.ng.bluemix.net/oidc/token,">https://iam.ng.bluemix.net/oidc/token,</a> and you will be given a token that can be used to make SoftLayer(IMS) api calls.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">IBMUSER</span><span class="o">=</span>myemail@email.com
<span class="nv">IBMPASS</span><span class="o">=</span>123qweasdzxc
curl -s -u <span class="s1">&#39;bx:bx&#39;</span> -k -X POST --header <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> --header <span class="s1">&#39;Accept: application/json&#39;</span> -d <span class="s2">&#34;grant_type=password&amp;response_type=cloud_iam,ims_portal&amp;username=</span><span class="nv">$IBMUSER</span><span class="s2">&amp;password=</span><span class="nv">$IBMPASS</span><span class="s2">&#34;</span> https://iam.cloud.ibm.com/identity/token
</code></pre></div><p>For users with an IBM email, you will need to use the SSO endpoint (the above example will also mention this if you try your username/password)</p>
<p>Tokens are retrieved from <a href="https://iam.cloud.ibm.com/identity/passcode">https://iam.cloud.ibm.com/identity/passcode</a></p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="nv">TOKEN</span><span class="o">=</span>qwe124cxzv
curl -s -u <span class="s1">&#39;bx:bx&#39;</span> -k -X POST --header <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> --header <span class="s1">&#39;Accept: application/json&#39;</span> -d <span class="s2">&#34;grant_type=urn:ibm:params:oauth:grant-type:passcode&amp;passcode=</span><span class="nv">$TOKEN</span><span class="s2">&amp;response_type=cloud_iam,ims_portal&#34;</span> https://iam.cloud.ibm.com/identity/token
</code></pre></div><h4 id="access_token">ACCESS_TOKEN</h4>
<p>In the response there will be a data field called &lsquo;access_token&rsquo;, which is a JWT token you can use for API authentication. Simply add it as a &ldquo;Authorization: Bearer $TOKEN&rdquo; HTTP header.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">curl -H <span class="s2">&#34;Authorization: Bearer zzzzzzzzzzzzzzzzzzzzzzzzzzaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaasssssssssssssssssssssssssssssssdddddddddddddddddddddddddddddddddddddd ETC ETC ETC.&#34;</span> <span class="s1">&#39;https://api.sotlayer.com/rest/v3.1/SoftLayer_Account/getObject&#39;</span>
</code></pre></div><p>There will also be a <code>refresh_token</code> which will only work to get you a new token.</p>
<h4 id="ims_token">IMS_TOKEN</h4>
<p>In the response there will be a data field call <code>ims_token</code> which will let you authenticate to the SoftLayer API until the token expires (which should also be in the returned data)</p>
<p>The REST endpoint doesn&rsquo;t support authenticating with tokens, but the MOBILE endpoint works, along with the SOAP/XML endpoints.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">curl -u USERID:IMS_TOKEN <span class="s1">&#39;https://api.softlayer.com/mobile/v3.1/SoftLayer_Account/getObject&#39;</span>
</code></pre></div><p>In the authentication header, you will set <code>userId</code> and <code>authToken</code>,  instead of <code>username</code> and <code>apiKey</code>. A call to SoftLayer_Customer::getObject would look like this in XML.</p>
<div class="highlight"><pre class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=\&#34;1.0\&#34; encoding=\&#34;UTF-8\&#34;?&gt;</span>
<span class="nt">&lt;methodCall&gt;</span>
  <span class="nt">&lt;methodName&gt;</span>getObject<span class="nt">&lt;/methodName&gt;</span>
  <span class="nt">&lt;params&gt;</span>
    <span class="nt">&lt;param&gt;</span>
      <span class="nt">&lt;value&gt;</span>
        <span class="nt">&lt;struct&gt;</span>
          <span class="nt">&lt;member&gt;</span>
            <span class="nt">&lt;name&gt;</span>headers<span class="nt">&lt;/name&gt;</span>
            <span class="nt">&lt;value&gt;</span>
              <span class="nt">&lt;struct&gt;</span>
                <span class="nt">&lt;member&gt;</span>
                  <span class="nt">&lt;name&gt;</span>authenticate<span class="nt">&lt;/name&gt;</span>
                  <span class="nt">&lt;value&gt;</span>
                    <span class="nt">&lt;struct&gt;</span>
                      <span class="nt">&lt;member&gt;</span>
                        <span class="nt">&lt;name&gt;</span>userId<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;value&gt;</span>
                          <span class="nt">&lt;int&gt;</span>$USERID<span class="nt">&lt;/int&gt;</span>
                        <span class="nt">&lt;/value&gt;</span>
                      <span class="nt">&lt;/member&gt;</span>
                      <span class="nt">&lt;member&gt;</span>
                        <span class="nt">&lt;name&gt;</span>complexType<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;value&gt;</span>
                          <span class="nt">&lt;string&gt;</span>PortalLoginToken<span class="nt">&lt;/string&gt;</span>
                        <span class="nt">&lt;/value&gt;</span>
                      <span class="nt">&lt;/member&gt;</span>
                      <span class="nt">&lt;member&gt;</span>
                        <span class="nt">&lt;name&gt;</span>authToken<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;value&gt;</span>
                          <span class="nt">&lt;string&gt;</span>$IMS_TOKEN<span class="nt">&lt;/string&gt;</span>
                        <span class="nt">&lt;/value&gt;</span>
                      <span class="nt">&lt;/member&gt;</span>
                    <span class="nt">&lt;/struct&gt;</span>
                  <span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;/member&gt;</span>
                <span class="nt">&lt;member&gt;</span>
                  <span class="nt">&lt;name&gt;</span>SoftLayer_User_CustomerInitParameters<span class="nt">&lt;/name&gt;</span>
                  <span class="nt">&lt;value&gt;</span>
                    <span class="nt">&lt;struct&gt;</span>
                      <span class="nt">&lt;member&gt;</span>
                        <span class="nt">&lt;name&gt;</span>id<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;value&gt;</span>
                          <span class="nt">&lt;int&gt;</span>$USERID<span class="nt">&lt;/int&gt;</span>
                        <span class="nt">&lt;/value&gt;</span>
                      <span class="nt">&lt;/member&gt;</span>
                    <span class="nt">&lt;/struct&gt;</span>
                  <span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;/member&gt;</span>
                <span class="nt">&lt;member&gt;</span>
                  <span class="nt">&lt;name&gt;</span>SoftLayer_ObjectMask<span class="nt">&lt;/name&gt;</span>
                  <span class="nt">&lt;value&gt;</span>
                    <span class="nt">&lt;struct&gt;</span>
                      <span class="nt">&lt;member&gt;</span>
                        <span class="nt">&lt;name&gt;</span>mask<span class="nt">&lt;/name&gt;</span>
                        <span class="nt">&lt;value&gt;</span>
                          <span class="nt">&lt;string&gt;</span>
                            mask[username;apiAuthenticationKeys]
                        <span class="nt">&lt;/string&gt;</span>
                        <span class="nt">&lt;/value&gt;</span>
                      <span class="nt">&lt;/member&gt;</span>
                    <span class="nt">&lt;/struct&gt;</span>
                  <span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;/member&gt;</span>
              <span class="nt">&lt;/struct&gt;</span>
            <span class="nt">&lt;/value&gt;</span>
          <span class="nt">&lt;/member&gt;</span>
        <span class="nt">&lt;/struct&gt;</span>
      <span class="nt">&lt;/value&gt;</span>
    <span class="nt">&lt;/param&gt;</span>
  <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/methodCall&gt;</span>
</code></pre></div><h2 id="using-the-softlayer-python-library-with-ims_token">Using the SoftLayer Python Library with IMS_TOKEN</h2>
<p>The following is a short example of how to get an IMS_TOKEN, and use it to make API calls with the SoftLayer Python library.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="s2">&#34;&#34;&#34;
</span><span class="s2">Uses an IBM ID username/password to make SoftLayer API calls. 
</span><span class="s2">
</span><span class="s2">Using this method, you MUST use the xmlrpc endpoint in your ~/.softlayer file
</span><span class="s2">`endpoint_url = https://api.softlayer.com/xmlrpc/v3.1/`
</span><span class="s2">
</span><span class="s2">To use a rest endpoint, you will ahve to use https://api.softlayer.com/mobile/v3.1/, 
</span><span class="s2">which isn&#39;t supported by the softlayer python library
</span><span class="s2">&#34;&#34;&#34;</span>
 

<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span> <span class="k">as</span> <span class="n">pp</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">click</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">SoftLayer</span>
<span class="kn">from</span> <span class="nn">SoftLayer.auth</span> <span class="kn">import</span> <span class="n">TokenAuthentication</span> <span class="k">as</span> <span class="n">TokenAuthentication</span>

<span class="k">class</span> <span class="nc">example</span><span class="p">():</span>
 
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ims_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ims_token_sso</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ims_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_ims_token_password</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="n">authObject</span> <span class="o">=</span> <span class="n">TokenAuthentication</span><span class="p">(</span><span class="n">ims_token</span><span class="p">[</span><span class="s1">&#39;ims_user_id&#39;</span><span class="p">],</span> <span class="n">ims_token</span><span class="p">[</span><span class="s1">&#39;ims_token&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">create_client_from_env</span><span class="p">(</span><span class="n">auth</span><span class="o">=</span><span class="n">authObject</span><span class="p">)</span>
        <span class="n">debugger</span> <span class="o">=</span> <span class="n">SoftLayer</span><span class="o">.</span><span class="n">DebugTransport</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transport</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transport</span> <span class="o">=</span> <span class="n">debugger</span>
        <span class="c1"># logger = logging.getLogger()</span>
        <span class="c1"># logger.addHandler(logging.StreamHandler())</span>
   
    <span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        Useful for printing out the exact API calls that were used. If using the rest transport, will print cure-able commands.
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">get_last_calls</span><span class="p">():</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">transport</span><span class="o">.</span><span class="n">print_reproduceable</span><span class="p">(</span><span class="n">call</span><span class="p">))</span>
 

    <span class="k">def</span> <span class="nf">get_ims_token_sso</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
        <span class="s2">&#34;&#34;&#34;
</span><span class="s2">        For accounts controlled by SSO, use this method.
</span><span class="s2">        &#34;&#34;&#34;</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://iam.ng.bluemix.net/oidc/token&#39;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;urn:ibm:params:oauth:grant-type:passcode&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;passcode&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">,</span>
            <span class="s1">&#39;response_type&#39;</span><span class="p">:</span> <span class="s1">&#39;cloud_iam,ims_portal&#39;</span>
        <span class="p">}</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
        <span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bx&#39;</span><span class="p">,</span><span class="s1">&#39;bx&#39;</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>

        <span class="c1"># This is what your token should look like.</span>
        <span class="c1"># Once you use an SSO token to get an IMS_TOKEN, it expires </span>
        <span class="c1"># so I use this as an easy way to save the IMS token response.</span>

        <span class="c1"># test_token = {</span>
        <span class="c1">#     &#39;access_token&#39;: &#39;REALLY LONG STRING GOES HERE&#39;,</span>
        <span class="c1">#     &#39;expiration&#39;: 1550699632,</span>
        <span class="c1">#     &#39;expires_in&#39;: 3600,</span>
        <span class="c1">#     &#39;ims_token&#39;: &#39;ANOTHER-REALLY-LONG_TOKEN_THING&#39;,</span>
        <span class="c1">#     &#39;ims_user_id&#39;: 244956,</span>
        <span class="c1">#     &#39;refresh_token&#39;: &#39;REALLYLONGTOKENGOESHERE&#39;,</span>
        <span class="c1">#     &#39;scope&#39;: &#39;ibm openid&#39;,</span>
        <span class="c1">#     &#39;token_type&#39;: &#39;Bearer&#39;</span>
        <span class="c1"># }</span>
        <span class="c1"># return test_token</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_ims_token_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="n">url</span> <span class="o">=</span> <span class="s1">&#39;https://iam.ng.bluemix.net/oidc/token&#39;</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;grant_type&#39;</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
            <span class="s1">&#39;password&#39;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
            <span class="s1">&#39;response_type&#39;</span><span class="p">:</span> <span class="s1">&#39;cloud_iam,ims_portal&#39;</span>
        <span class="p">}</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/x-www-form-urlencoded&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Accept&#39;</span><span class="p">:</span> <span class="s1">&#39;application/json&#39;</span>
        <span class="p">}</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">auth</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;bx&#39;</span><span class="p">,</span><span class="s1">&#39;bx&#39;</span><span class="p">),</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="n">pp</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">account</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s1">&#39;Account&#39;</span><span class="p">,</span> <span class="s1">&#39;getObject&#39;</span><span class="p">)</span>
        <span class="n">pp</span><span class="p">(</span><span class="n">account</span><span class="p">)</span>

<span class="nd">@click.command</span><span class="p">()</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--sso&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;SSO token from https://iam-id-1.ng.bluemix.net/identity/passcode&#39;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--username&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;IBM Id Username&#39;</span><span class="p">)</span>
<span class="nd">@click.option</span><span class="p">(</span><span class="s1">&#39;--password&#39;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s1">&#39;IBM Id Password&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">sso</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="n">main</span> <span class="o">=</span> <span class="n">example</span><span class="p">(</span><span class="n">sso</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="n">main</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
    <span class="c1"># Uncomment this to print out the API calls made.</span>
    <span class="n">main</span><span class="o">.</span><span class="n">debug</span><span class="p">()</span>
 
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div>
            </div>
        </div>

    </div>
    <hr>
    <div class="row">
        <div class="col-md-6">
    <div class="well well-sm" style="word-wrap: break-word;"> 
        <strong>Feedback? <span class="fas fa-comment"/></strong>
            <p>
                If this article contains any error, or leaves any of your questions unanswered, please help us out by 
                opening up a github issue.<br>
                <a class="" href="https://github.com/softlayer/githubio_source/issues/new?title=Feedback%20for%20article%20-%20Authenticating%20to%20the%20SoftLayer%20API&body=Feedback+regarding%3A%20https%3a%2f%2fsldn.softlayer.com%2farticle%2fauthenticating-softlayer-api%2f"> Open an issue</a>
                <i class="fab fa-github" alt="github"></i>
            </p>
    </div>
</div>
    </div>
        <footer>
            <div class="row">
                <hr>
                <div class="col-sm-12">
                    <p>&copy; SoftLayer 2020<br>
                    Built with <a href="https://github.com/spf13/hugo">Hugo</a></p>
                </div>
            </div>
        </footer>
</div>

    <script src="https://sldn.softlayer.com/js/jquery.js"></script>
    <script src="https://sldn.softlayer.com/js/bootstrap.js"></script>
</body>
</html>

